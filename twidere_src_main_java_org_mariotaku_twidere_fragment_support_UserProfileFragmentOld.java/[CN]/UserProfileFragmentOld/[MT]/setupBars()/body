{
  final FragmentActivity activity=getActivity();
  if (!(activity instanceof LinkHandlerActivity))   return;
  final LinkHandlerActivity linkHandler=(LinkHandlerActivity)activity;
  final ActionBar actionBar=linkHandler.getActionBar();
  if (actionBar == null)   return;
  final int themeColor=linkHandler.getThemeColor();
  final int themeResId=linkHandler.getCurrentThemeResourceId();
  final boolean isTransparent=ThemeUtils.isTransparentBackground(themeResId);
  final int actionBarAlpha=isTransparent ? ThemeUtils.getUserThemeBackgroundAlpha(linkHandler) : 0xFF;
  mActionBarShadow=activity.getResources().getDrawable(R.drawable.shadow_user_banner_action_bar);
  if (mActionBarShadow instanceof ShapeDrawable) {
    final ShapeDrawable sd=(ShapeDrawable)mActionBarBackground;
    sd.setIntrinsicHeight(actionBar.getHeight());
    sd.setIntrinsicWidth(activity.getWindowManager().getDefaultDisplay().getWidth());
  }
  if (ThemeUtils.isColoredActionBar(themeResId) && useUserActionBar()) {
    mActionBarBackground=new ColorDrawable(themeColor);
  }
 else {
    mActionBarBackground=ThemeUtils.getActionBarBackground(activity,themeResId);
  }
  actionBar.setBackgroundDrawable(new ActionBarDrawable(mActionBarShadow,mActionBarBackground));
}
