{
  final Resources res=getResources();
  final boolean hasOfficialKeyAccounts=Utils.hasAccountSignedWithOfficialKeys(getActivity());
  final long[] account_ids=getAccountIds(getActivity());
  final MenuItem itemAdd=menu.findItem(R.id.add_submenu);
  if (itemAdd != null && itemAdd.hasSubMenu()) {
    final SubMenu subMenu=itemAdd.getSubMenu();
    subMenu.clear();
    final HashMap<String,CustomTabConfiguration> map=getConfiguraionMap();
    final List<Entry<String,CustomTabConfiguration>> tabs=new ArrayList<Entry<String,CustomTabConfiguration>>(map.entrySet());
    Collections.sort(tabs,CustomTabConfigurationComparator.SINGLETON);
    for (    final Entry<String,CustomTabConfiguration> entry : tabs) {
      final String type=entry.getKey();
      final CustomTabConfiguration conf=entry.getValue();
      final boolean isOfficiakKeyAccountRequired=TAB_TYPE_ACTIVITIES_ABOUT_ME.equals(type) || TAB_TYPE_ACTIVITIES_BY_FRIENDS.equals(type);
      final boolean accountIdRequired=conf.getAccountRequirement() == CustomTabConfiguration.ACCOUNT_REQUIRED;
      final Intent intent=new Intent(INTENT_ACTION_ADD_TAB);
      intent.setClass(getActivity(),CustomTabEditorActivity.class);
      intent.putExtra(EXTRA_TYPE,type);
      intent.putExtra(EXTRA_OFFICIAL_KEY_ONLY,isOfficiakKeyAccountRequired);
      final MenuItem subItem=subMenu.add(conf.getDefaultTitle());
      final boolean shouldDisable=conf.isSingleTab() && isTabAdded(getActivity(),type) || isOfficiakKeyAccountRequired && !hasOfficialKeyAccounts || accountIdRequired && account_ids.length == 0;
      subItem.setVisible(!shouldDisable);
      subItem.setEnabled(!shouldDisable);
      final Drawable icon=res.getDrawable(conf.getDefaultIcon());
      subItem.setIcon(icon);
      subItem.setIntent(intent);
    }
  }
}
