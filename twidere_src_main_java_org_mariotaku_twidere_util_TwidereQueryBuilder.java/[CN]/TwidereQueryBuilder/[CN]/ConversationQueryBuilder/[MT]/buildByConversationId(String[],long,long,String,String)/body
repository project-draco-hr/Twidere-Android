{
  final Selectable select=Utils.getColumnsFromProjection(projection);
  final SQLSelectQuery.Builder qb=SQLQueryBuilder.select(select);
  qb.from(new Tables(DirectMessages.TABLE_NAME));
  final Expression accountIdWhere=Expression.equals(DirectMessages.ACCOUNT_KEY,account_id);
  final Expression incomingWhere=Expression.and(Expression.notEquals(DirectMessages.IS_OUTGOING,1),Expression.equals(DirectMessages.SENDER_ID,conversationId));
  final Expression outgoingWhere=Expression.and(Expression.equals(DirectMessages.IS_OUTGOING,1),Expression.equals(DirectMessages.RECIPIENT_ID,conversationId));
  final Expression conversationWhere=Expression.or(incomingWhere,outgoingWhere);
  if (selection != null) {
    qb.where(Expression.and(accountIdWhere,conversationWhere,new Expression(selection)));
  }
 else {
    qb.where(Expression.and(accountIdWhere,conversationWhere));
  }
  qb.orderBy(new OrderBy(sortOrder != null ? sortOrder : Conversation.DEFAULT_SORT_ORDER));
  return qb.build();
}
