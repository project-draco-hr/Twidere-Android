{
  final SQLSelectQuery filteredUsersQuery=SQLQueryBuilder.select(new Column(new Table(Filters.Users.TABLE_NAME),Filters.Users.USER_KEY)).from(new Tables(Filters.Users.TABLE_NAME)).build();
  final Expression filteredUsersWhere=Expression.or(Expression.in(new Column(new Table(table),Activities.STATUS_USER_KEY),filteredUsersQuery),Expression.in(new Column(new Table(table),Activities.STATUS_RETWEETED_BY_USER_KEY),filteredUsersQuery),Expression.in(new Column(new Table(table),Activities.STATUS_QUOTED_USER_KEY),filteredUsersQuery));
  final SQLSelectQuery.Builder filteredIdsQueryBuilder=SQLQueryBuilder.select(new Column(new Table(table),Activities._ID)).from(new Tables(table)).where(filteredUsersWhere).union().select(new Columns(new Column(new Table(table),Activities._ID))).from(new Tables(table,Filters.Sources.TABLE_NAME)).where(Expression.or(Expression.likeRaw(new Column(new Table(table),Activities.STATUS_SOURCE),"'%>'||" + Filters.Sources.TABLE_NAME + "."+ Filters.Sources.VALUE+ "||'</a>%'"),Expression.likeRaw(new Column(new Table(table),Activities.STATUS_QUOTE_SOURCE),"'%>'||" + Filters.Sources.TABLE_NAME + "."+ Filters.Sources.VALUE+ "||'</a>%'"))).union().select(new Columns(new Column(new Table(table),Activities._ID))).from(new Tables(table,Filters.Keywords.TABLE_NAME)).where(Expression.or(Expression.likeRaw(new Column(new Table(table),Activities.STATUS_TEXT_PLAIN),"'%'||" + Filters.Keywords.TABLE_NAME + "."+ Filters.Keywords.VALUE+ "||'%'"),Expression.likeRaw(new Column(new Table(table),Activities.STATUS_QUOTE_TEXT_PLAIN),"'%'||" + Filters.Keywords.TABLE_NAME + "."+ Filters.Keywords.VALUE+ "||'%'"))).union().select(new Columns(new Column(new Table(table),Activities._ID))).from(new Tables(table,Filters.Links.TABLE_NAME)).where(Expression.or(Expression.likeRaw(new Column(new Table(table),Activities.STATUS_SPANS),"'%'||" + Filters.Links.TABLE_NAME + "."+ Filters.Links.VALUE+ "||'%'"),Expression.likeRaw(new Column(new Table(table),Activities.STATUS_QUOTE_SPANS),"'%'||" + Filters.Links.TABLE_NAME + "."+ Filters.Links.VALUE+ "||'%'")));
  final Expression filterExpression=Expression.or(Expression.notIn(new Column(new Table(table),Activities._ID),filteredIdsQueryBuilder.build()),Expression.equals(new Column(new Table(table),Activities.IS_GAP),1));
  if (extraSelection != null) {
    return Expression.and(filterExpression,extraSelection);
  }
  return filterExpression;
}
