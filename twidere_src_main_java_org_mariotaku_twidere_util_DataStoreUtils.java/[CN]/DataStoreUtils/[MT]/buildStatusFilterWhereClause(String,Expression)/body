{
  final SQLSelectQuery filteredUsersQuery=SQLQueryBuilder.select(new Columns.Column(new Table(Filters.Users.TABLE_NAME),Filters.Users.USER_ID)).from(new Tables(Filters.Users.TABLE_NAME)).build();
  final SQLSelectQuery selectCTEIds=SQLQueryBuilder.select(new Columns.Column(Filters.Users.USER_ID)).from(new Table("cte_filtered_user_ids")).build();
  final Expression filteredUsersWhere=Expression.or(Expression.in(new Columns.Column(new Table(table),Statuses.USER_ID),selectCTEIds),Expression.in(new Columns.Column(new Table(table),Statuses.RETWEETED_BY_USER_ID),selectCTEIds),Expression.in(new Columns.Column(new Table(table),Statuses.QUOTED_USER_ID),selectCTEIds));
  final SQLSelectQuery.Builder filteredIdsQueryBuilder=SQLQueryBuilder.with("cte_filtered_user_ids",filteredUsersQuery).select(new Columns.Column(new Table(table),Statuses._ID)).from(new Tables(table)).where(filteredUsersWhere).union().select(new Columns(new Columns.Column(new Table(table),Statuses._ID))).from(new Tables(table,Filters.Sources.TABLE_NAME)).where(Expression.or(Expression.likeRaw(new Columns.Column(new Table(table),Statuses.SOURCE),"'%>'||" + Filters.Sources.TABLE_NAME + "."+ Filters.Sources.VALUE+ "||'</a>%'"),Expression.likeRaw(new Columns.Column(new Table(table),Statuses.QUOTED_SOURCE),"'%>'||" + Filters.Sources.TABLE_NAME + "."+ Filters.Sources.VALUE+ "||'</a>%'"))).union().select(new Columns(new Columns.Column(new Table(table),Statuses._ID))).from(new Tables(table,Filters.Keywords.TABLE_NAME)).where(Expression.or(Expression.likeRaw(new Columns.Column(new Table(table),Statuses.TEXT_PLAIN),"'%'||" + Filters.Keywords.TABLE_NAME + "."+ Filters.Keywords.VALUE+ "||'%'"),Expression.likeRaw(new Columns.Column(new Table(table),Statuses.QUOTED_TEXT_PLAIN),"'%'||" + Filters.Keywords.TABLE_NAME + "."+ Filters.Keywords.VALUE+ "||'%'"))).union().select(new Columns(new Columns.Column(new Table(table),Statuses._ID))).from(new Tables(table,Filters.Links.TABLE_NAME)).where(Expression.or(Expression.likeRaw(new Columns.Column(new Table(table),Statuses.TEXT_HTML),"'%>%'||" + Filters.Links.TABLE_NAME + "."+ Filters.Links.VALUE+ "||'%</a>%'"),Expression.likeRaw(new Columns.Column(new Table(table),Statuses.QUOTED_TEXT_HTML),"'%>%'||" + Filters.Links.TABLE_NAME + "."+ Filters.Links.VALUE+ "||'%</a>%'")));
  final Expression filterExpression=Expression.or(Expression.notIn(new Columns.Column(new Table(table),Statuses._ID),filteredIdsQueryBuilder.build()),Expression.equals(new Columns.Column(new Table(table),Statuses.IS_GAP),1));
  if (extraSelection != null) {
    return Expression.and(filterExpression,extraSelection);
  }
  return filterExpression;
}
