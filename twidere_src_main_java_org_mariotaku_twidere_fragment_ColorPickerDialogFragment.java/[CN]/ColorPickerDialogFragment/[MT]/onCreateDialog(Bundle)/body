{
  final int color;
  final Bundle args=getArguments();
  if (savedInstanceState != null) {
    color=savedInstanceState.getInt(EXTRA_COLOR,Color.WHITE);
  }
 else {
    color=args.getInt(EXTRA_COLOR,Color.WHITE);
  }
  final FragmentActivity activity=getActivity();
  final AlertDialog.Builder builder=new AlertDialog.Builder(activity);
  builder.setView(me.uucky.colorpicker.R.layout.cp__dialog_color_picker);
  builder.setPositiveButton(android.R.string.ok,this);
  if (args.getBoolean(EXTRA_CLEAR_BUTTON,false)) {
    builder.setNeutralButton(R.string.clear,this);
  }
  builder.setNegativeButton(android.R.string.cancel,this);
  final AlertDialog dialog=builder.create();
  dialog.setOnShowListener(new DialogInterface.OnShowListener(){
    @Override public void onShow(    DialogInterface di){
      final Dialog dialog=(Dialog)di;
      mController=new ColorPickerDialog.Controller(dialog.getContext(),dialog.getWindow().getDecorView());
      final boolean showAlphaSlider=args.getBoolean(EXTRA_ALPHA_SLIDER,true);
      for (      int presetColor : PRESET_COLORS) {
        mController.addColor(ContextCompat.getColor(getContext(),presetColor));
      }
      mController.setAlphaEnabled(showAlphaSlider);
      mController.setInitialColor(color);
    }
  }
);
  return dialog;
}
