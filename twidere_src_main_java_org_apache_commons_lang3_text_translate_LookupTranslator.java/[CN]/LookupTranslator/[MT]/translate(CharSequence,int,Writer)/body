{
  int max=longest;
  if (index + longest > input.length()) {
    max=input.length() - index;
  }
  for (int i=max; i >= shortest; i--) {
    final CharSequence subSeq=input.subSequence(index,index + i);
    final CharSequence result=lookupMap.get(subSeq);
    if (result != null) {
      out.write(result.toString());
      return i;
    }
  }
  return 0;
}
