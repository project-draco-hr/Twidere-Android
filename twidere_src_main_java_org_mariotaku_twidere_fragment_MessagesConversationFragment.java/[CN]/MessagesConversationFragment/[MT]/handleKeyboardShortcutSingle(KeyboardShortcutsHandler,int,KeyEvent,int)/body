{
  final String action=handler.getKeyAction(CONTEXT_TAG_NAVIGATION,keyCode,event,metaState);
  if (ACTION_NAVIGATION_BACK.equals(action)) {
    final boolean showingConversation=isShowingConversation();
    final EditText editText=showingConversation ? mEditText : mEditUserQuery;
    final boolean textChanged=showingConversation ? mTextChanged : mQueryTextChanged;
    if (editText.length() == 0 && !textChanged) {
      final FragmentActivity activity=getActivity();
      if (!mNavigateBackPressed) {
        Toast.makeText(activity,R.string.press_again_to_close,Toast.LENGTH_SHORT).show();
        editText.removeCallbacks(mBackTimeoutRunnable);
        editText.postDelayed(mBackTimeoutRunnable,2000);
        mNavigateBackPressed=true;
      }
 else {
        activity.onBackPressed();
      }
    }
 else {
      mQueryTextChanged=false;
      mTextChanged=false;
    }
    return true;
  }
  return false;
}
