{
  if (mLocationListener != null)   return true;
  final boolean attachLocation=mPreferences.getBoolean(KEY_ATTACH_LOCATION);
  if (!attachLocation) {
    return false;
  }
  final boolean attachPreciseLocation=mPreferences.getBoolean(KEY_ATTACH_PRECISE_LOCATION);
  final Criteria criteria=new Criteria();
  if (attachPreciseLocation) {
    criteria.setAccuracy(Criteria.ACCURACY_FINE);
  }
 else {
    criteria.setAccuracy(Criteria.ACCURACY_COARSE);
  }
  final String provider=mLocationManager.getBestProvider(criteria,true);
  if (provider != null) {
    mLocationText.setText(R.string.getting_location);
    mLocationListener=new ComposeLocationListener(this);
    mLocationManager.requestLocationUpdates(provider,0,0,mLocationListener);
    final Location location=Utils.getCachedLocation(this);
    if (location != null) {
      mLocationListener.onLocationChanged(location);
    }
  }
 else {
    Toast.makeText(this,R.string.cannot_get_location,Toast.LENGTH_SHORT).show();
  }
  return provider != null;
}
