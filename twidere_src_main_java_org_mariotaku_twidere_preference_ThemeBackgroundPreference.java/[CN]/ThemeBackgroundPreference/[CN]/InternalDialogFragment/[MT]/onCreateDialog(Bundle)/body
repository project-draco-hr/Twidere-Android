{
  AlertDialog.Builder builder=new AlertDialog.Builder(getContext());
  final ThemeBackgroundPreference preference=(ThemeBackgroundPreference)getPreference();
  final SharedPreferences preferences=preference.getSharedPreferences();
  preference.setValue(preference.getPersistedString(null));
  builder.setTitle(preference.getDialogTitle());
  builder.setSingleChoiceItems(preference.mBackgroundEntries,preference.getValueIndex(),new OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      preference.setSelectedOption(which);
      updateAlphaVisibility();
    }
  }
);
  builder.setPositiveButton(android.R.string.ok,this);
  builder.setNegativeButton(android.R.string.cancel,this);
  final AlertDialog dialog=builder.create();
  dialog.setOnShowListener(new DialogInterface.OnShowListener(){
    @Override public void onShow(    DialogInterface dialog){
      if (dialog instanceof AlertDialog && preferences != null) {
        AlertDialog alertDialog=(AlertDialog)dialog;
        final LayoutInflater inflater=alertDialog.getLayoutInflater();
        final ListView listView=alertDialog.getListView();
        final ViewGroup listViewParent=(ViewGroup)listView.getParent();
        listViewParent.removeView(listView);
        final View view=inflater.inflate(R.layout.dialog_theme_background_preference,listViewParent);
        ((ViewGroup)view.findViewById(R.id.list_container)).addView(listView);
        mAlphaContainer=view.findViewById(R.id.alpha_container);
        mAlphaSlider=(SeekBar)view.findViewById(R.id.alpha_slider);
        mAlphaSlider.setMax(MAX_ALPHA - MIN_ALPHA);
        mAlphaSlider.setProgress(preferences.getInt(KEY_THEME_BACKGROUND_ALPHA,DEFAULT_THEME_BACKGROUND_ALPHA) - MIN_ALPHA);
        updateAlphaVisibility();
      }
    }
  }
);
  return dialog;
}
