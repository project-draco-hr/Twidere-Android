{
  final List<ParcelableCredentials> accountsList=DataStoreUtils.getCredentialsList(this,true);
  final AccountKey[] accountKeys=new AccountKey[accountsList.size()];
  for (int i=0, j=accountKeys.length; i < j; i++) {
    final ParcelableCredentials credentials=accountsList.get(i);
    accountKeys[i]=new AccountKey(credentials.account_key,credentials.account_host);
  }
  final AccountPreferences[] activatedPreferences=AccountPreferences.getAccountPreferences(this,accountKeys);
  if (BuildConfig.DEBUG) {
    Log.d(Constants.LOGTAG,"Setting up twitter stream instances");
  }
  mAccountKeys=accountKeys;
  clearTwitterInstances();
  boolean result=false;
  for (int i=0, j=accountsList.size(); i < j; i++) {
    final AccountPreferences preferences=activatedPreferences[i];
    if (!preferences.isStreamingEnabled())     continue;
    final ParcelableCredentials account=accountsList.get(i);
    final Endpoint endpoint=TwitterAPIFactory.getEndpoint(account,TwitterUserStream.class);
    final Authorization authorization=TwitterAPIFactory.getAuthorization(account);
    final TwitterUserStream twitter=TwitterAPIFactory.getInstance(this,endpoint,authorization,TwitterUserStream.class);
    final TwidereUserStreamCallback callback=new TwidereUserStreamCallback(this,account);
    mCallbacks.put(account.account_key,callback);
    new Thread(){
      @Override public void run(){
        twitter.getUserStream(callback);
        Log.d(Constants.LOGTAG,String.format("Stream %d disconnected",account.account_key));
        mCallbacks.remove(account.account_key);
        updateStreamState();
      }
    }
.start();
    result|=true;
  }
  return result;
}
