{
  if (card == null)   return null;
  final String name=card.getName();
  if ("animated_gif".equals(name) || "player".equals(name)) {
    final ParcelableMedia media=new ParcelableMedia();
    final BindingValue playerStreamUrl=card.getBindingValue("player_stream_url");
    media.card=ParcelableCardEntity.fromCardEntity(card,-1);
    StringValue appUrlResolved=(StringValue)card.getBindingValue("app_url_resolved");
    media.url=appUrlResolved != null ? appUrlResolved.getValue() : card.getUrl();
    if ("animated_gif".equals(name)) {
      media.media_url=((StringValue)playerStreamUrl).getValue();
      media.type=Type.TYPE_CARD_ANIMATED_GIF;
    }
 else     if (playerStreamUrl instanceof StringValue) {
      media.media_url=((StringValue)playerStreamUrl).getValue();
      media.type=Type.TYPE_VIDEO;
    }
 else {
      StringValue playerUrl=(StringValue)card.getBindingValue("player_url");
      if (playerUrl != null) {
        media.media_url=playerUrl.getValue();
      }
      media.type=Type.TYPE_EXTERNAL_PLAYER;
    }
    final BindingValue playerImage=card.getBindingValue("player_image");
    if (playerImage instanceof ImageValue) {
      media.preview_url=((ImageValue)playerImage).getUrl();
      media.width=((ImageValue)playerImage).getWidth();
      media.height=((ImageValue)playerImage).getHeight();
    }
    final BindingValue playerWidth=card.getBindingValue("player_width");
    final BindingValue playerHeight=card.getBindingValue("player_height");
    if (playerWidth instanceof StringValue && playerHeight instanceof StringValue) {
      media.width=NumberUtils.toInt(((StringValue)playerWidth).getValue(),-1);
      media.height=NumberUtils.toInt(((StringValue)playerHeight).getValue(),-1);
    }
    if (entities != null) {
      for (      UrlEntity entity : entities) {
        if (entity.getUrl().equals(media.url)) {
          media.start=entity.getStart();
          media.end=entity.getEnd();
          break;
        }
      }
    }
    return new ParcelableMedia[]{media};
  }
 else   if ("summary_large_image".equals(name)) {
    final BindingValue photoImageFullSize=card.getBindingValue("photo_image_full_size");
    if (!(photoImageFullSize instanceof ImageValue))     return null;
    final ParcelableMedia media=new ParcelableMedia();
    media.url=card.getUrl();
    media.card=ParcelableCardEntity.fromCardEntity(card,-1);
    media.type=Type.TYPE_IMAGE;
    media.media_url=((ImageValue)photoImageFullSize).getUrl();
    media.width=((ImageValue)photoImageFullSize).getWidth();
    media.height=((ImageValue)photoImageFullSize).getHeight();
    final BindingValue summaryPhotoImage=card.getBindingValue("summary_photo_image");
    if (summaryPhotoImage instanceof ImageValue) {
      media.preview_url=((ImageValue)summaryPhotoImage).getUrl();
    }
    if (entities != null) {
      for (      UrlEntity entity : entities) {
        if (entity.getUrl().equals(media.url)) {
          media.start=entity.getStart();
          media.end=entity.getEnd();
          break;
        }
      }
    }
    return new ParcelableMedia[]{media};
  }
  return null;
}
