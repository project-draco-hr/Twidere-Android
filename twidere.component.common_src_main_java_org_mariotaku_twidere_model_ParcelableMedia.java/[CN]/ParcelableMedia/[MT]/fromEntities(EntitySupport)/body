{
  if (entities == null)   return null;
  final List<ParcelableMedia> list=new ArrayList<>();
  final MediaEntity[] mediaEntities;
  if (entities instanceof ExtendedEntitySupport) {
    final ExtendedEntitySupport extendedEntities=(ExtendedEntitySupport)entities;
    final MediaEntity[] extendedMediaEntities=extendedEntities.getExtendedMediaEntities();
    mediaEntities=extendedMediaEntities != null ? extendedMediaEntities : entities.getMediaEntities();
  }
 else {
    mediaEntities=entities.getMediaEntities();
  }
  if (mediaEntities != null) {
    for (    final MediaEntity media : mediaEntities) {
      final String mediaURL=media.getMediaURL();
      if (mediaURL != null) {
        list.add(new ParcelableMedia(media));
      }
    }
  }
  final URLEntity[] urlEntities=entities.getURLEntities();
  if (urlEntities != null) {
    for (    final URLEntity url : urlEntities) {
      final String expanded=url.getExpandedURL();
      final String media_url=MediaPreviewUtils.getSupportedLink(expanded);
      if (expanded != null && media_url != null) {
        final ParcelableMedia media=new ParcelableMedia();
        media.type=TYPE_IMAGE;
        media.page_url=expanded;
        media.media_url=media_url;
        media.preview_url=media_url;
        media.start=url.getStart();
        media.end=url.getEnd();
        list.add(media);
      }
    }
  }
  if (list.isEmpty())   return null;
  return list.toArray(new ParcelableMedia[list.size()]);
}
