{
  final FragmentActivity activity=getActivity();
  final Context wrapped=ThemeUtils.getDialogThemedContext(activity);
  final AlertDialog.Builder builder=new AlertDialog.Builder(wrapped);
  buildDialog(builder);
  builder.setView(R.layout.dialog_auto_complete_textview);
  builder.setTitle(R.string.add_rule);
  builder.setPositiveButton(android.R.string.ok,this);
  builder.setNegativeButton(android.R.string.cancel,this);
  final AlertDialog dialog=builder.create();
  dialog.setOnShowListener(new DialogInterface.OnShowListener(){
    @Override public void onShow(    DialogInterface dialog){
      AlertDialog alertDialog=(AlertDialog)dialog;
      final AutoCompleteTextView editText=(AutoCompleteTextView)alertDialog.findViewById(R.id.edit_text);
      final Bundle args=getArguments();
      final int autoCompleteType;
      autoCompleteType=args.getInt(EXTRA_AUTO_COMPLETE_TYPE,0);
      if (autoCompleteType != 0) {
        SimpleCursorAdapter mUserAutoCompleteAdapter;
        if (autoCompleteType == AUTO_COMPLETE_TYPE_SOURCES) {
          mUserAutoCompleteAdapter=new SourceAutoCompleteAdapter(activity);
        }
 else {
          final ComposeAutoCompleteAdapter adapter=new ComposeAutoCompleteAdapter(activity);
          adapter.setAccountId(Utils.getDefaultAccountId(activity));
          mUserAutoCompleteAdapter=adapter;
        }
        editText.setAdapter(mUserAutoCompleteAdapter);
        editText.setThreshold(1);
      }
    }
  }
);
  return dialog;
}
