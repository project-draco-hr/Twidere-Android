{
  final LocationManager lm=mLocationManager;
  try {
    lm.removeUpdates(this);
  }
 catch (  SecurityException ignore) {
  }
  final boolean attachLocation=mPreferences.getBoolean(KEY_ATTACH_LOCATION);
  if (!attachLocation) {
    return false;
  }
  final Criteria criteria=new Criteria();
  criteria.setAccuracy(Criteria.ACCURACY_FINE);
  final String provider=lm.getBestProvider(criteria,true);
  if (provider != null) {
    try {
      mLocationText.setText(R.string.getting_location);
      lm.requestLocationUpdates(provider,0,0,this);
      final Location location=Utils.getCachedLocation(this);
      if (location != null) {
        onLocationChanged(location);
      }
    }
 catch (    SecurityException e) {
      return false;
    }
  }
 else {
    Toast.makeText(this,R.string.cannot_get_location,Toast.LENGTH_SHORT).show();
  }
  return provider != null;
}
