{
  final boolean sendByEnter=mPreferences.getBoolean(KEY_QUICK_SEND);
  EditTextEnterHandler.attach(mEditText,new EnterListener(){
    @Override public void onHitEnter(){
      updateStatus();
    }
  }
,sendByEnter);
  mEditText.addTextChangedListener(new TextWatcher(){
    @Override public void beforeTextChanged(    final CharSequence s,    final int start,    final int count,    final int after){
    }
    @Override public void onTextChanged(    final CharSequence s,    final int start,    final int before,    final int count){
      setMenu();
      updateTextCount();
      if (s instanceof Spannable && count == 1 && before == 0) {
        final ImageSpan[] imageSpans=((Spannable)s).getSpans(start,start + count,ImageSpan.class);
        if (imageSpans.length == 1) {
          Toast.makeText(ComposeActivity.this,imageSpans[0].getSource(),Toast.LENGTH_SHORT).show();
        }
      }
    }
    @Override public void afterTextChanged(    final Editable s){
      mTextChanged=s.length() == 0;
    }
  }
);
  mEditText.setCustomSelectionActionModeCallback(this);
}
