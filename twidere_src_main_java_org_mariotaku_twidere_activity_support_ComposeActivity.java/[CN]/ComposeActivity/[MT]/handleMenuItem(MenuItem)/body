{
switch (item.getItemId()) {
case MENU_TAKE_PHOTO:
case R.id.take_photo_sub_item:
{
      takePhoto();
      break;
    }
case MENU_ADD_IMAGE:
case R.id.add_image_sub_item:
{
    if (Build.VERSION.SDK_INT < Build.VERSION_CODES.KITKAT || !openDocument()) {
      pickImage();
    }
    break;
  }
case MENU_ADD_LOCATION:
{
  final boolean attachLocation=mPreferences.getBoolean(KEY_ATTACH_LOCATION,false);
  if (!attachLocation) {
    getLocation();
  }
 else {
    mLocationManager.removeUpdates(this);
  }
  mPreferences.edit().putBoolean(KEY_ATTACH_LOCATION,!attachLocation).apply();
  setMenu();
  updateTextCount();
  break;
}
case MENU_DRAFTS:
{
startActivity(new Intent(INTENT_ACTION_DRAFTS));
break;
}
case MENU_DELETE:
{
new DeleteImageTask(this).executeTask();
break;
}
case MENU_TOGGLE_SENSITIVE:
{
if (!hasMedia()) return false;
mIsPossiblySensitive=!mIsPossiblySensitive;
setMenu();
updateTextCount();
break;
}
case MENU_VIEW:
{
if (mInReplyToStatus == null) return false;
final DialogFragment fragment=new ViewStatusDialogFragment();
final Bundle args=new Bundle();
args.putParcelable(EXTRA_STATUS,mInReplyToStatus);
fragment.setArguments(args);
fragment.show(getSupportFragmentManager(),"view_status");
break;
}
default :
{
final Intent intent=item.getIntent();
if (intent != null) {
try {
final String action=intent.getAction();
if (INTENT_ACTION_EXTENSION_COMPOSE.equals(action)) {
intent.putExtra(EXTRA_TEXT,ParseUtils.parseString(mEditText.getText()));
intent.putExtra(EXTRA_ACCOUNT_IDS,mSendAccountIds);
if (mSendAccountIds != null && mSendAccountIds.length > 0) {
final long account_id=mSendAccountIds[0];
intent.putExtra(EXTRA_NAME,getAccountName(this,account_id));
intent.putExtra(EXTRA_SCREEN_NAME,getAccountScreenName(this,account_id));
}
if (mInReplyToStatusId > 0) {
intent.putExtra(EXTRA_IN_REPLY_TO_ID,mInReplyToStatusId);
}
if (mInReplyToStatus != null) {
intent.putExtra(EXTRA_IN_REPLY_TO_NAME,mInReplyToStatus.user_name);
intent.putExtra(EXTRA_IN_REPLY_TO_SCREEN_NAME,mInReplyToStatus.user_screen_name);
}
startActivityForResult(intent,REQUEST_EXTENSION_COMPOSE);
}
 else if (INTENT_ACTION_EXTENSION_EDIT_IMAGE.equals(action)) {
}
 else {
startActivity(intent);
}
}
 catch (final ActivityNotFoundException e) {
Log.w(LOGTAG,e);
return false;
}
}
break;
}
}
return true;
}
