{
  final SSLSocket sslsock=(SSLSocket)socketfactory.createSocket(socket,target,port,true);
  if (supportedProtocols != null) {
    sslsock.setEnabledProtocols(supportedProtocols);
  }
  if (supportedCipherSuites != null) {
    sslsock.setEnabledCipherSuites(supportedCipherSuites);
  }
  prepareSocket(sslsock);
  if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
    if (socketfactory instanceof SSLCertificateSocketFactory) {
      if (Log.isLoggable(TAG,Log.DEBUG)) {
        Log.d(TAG,"Enabling SNI for " + target);
      }
      ((SSLCertificateSocketFactory)socketfactory).setHostname(sslsock,target);
    }
  }
  sslsock.startHandshake();
  verifyHostname(sslsock,target,context);
  return sslsock;
}
