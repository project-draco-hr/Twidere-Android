{
  final AsyncTwitterWrapper twitter=mTwitterWrapper;
  final ParcelableUser user=getUser();
  final UserRelationship userRelationship=mRelationship;
  if (user == null || twitter == null)   return false;
switch (item.getItemId()) {
case R.id.block:
{
      if (userRelationship == null)       return true;
      if (userRelationship.blocking) {
        twitter.destroyBlockAsync(user.account_key,user.key);
      }
 else {
        CreateUserBlockDialogFragment.show(getFragmentManager(),user);
      }
      break;
    }
case R.id.report_spam:
{
    ReportSpamDialogFragment.show(getFragmentManager(),user);
    break;
  }
case R.id.add_to_filter:
{
  if (userRelationship == null)   return true;
  final ContentResolver cr=getContentResolver();
  if (userRelationship.filtering) {
    final String where=Expression.equalsArgs(Filters.Users.USER_KEY).getSQL();
    final String[] whereArgs={user.key.toString()};
    cr.delete(Filters.Users.CONTENT_URI,where,whereArgs);
    Utils.showInfoMessage(getActivity(),R.string.message_user_unmuted,false);
  }
 else {
    cr.insert(Filters.Users.CONTENT_URI,ContentValuesCreator.createFilteredUser(user));
    Utils.showInfoMessage(getActivity(),R.string.message_user_muted,false);
  }
  break;
}
case R.id.mute_user:
{
if (userRelationship == null) return true;
if (userRelationship.muting) {
  twitter.destroyMuteAsync(user.account_key,user.key);
}
 else {
  CreateUserMuteDialogFragment.show(getFragmentManager(),user);
}
break;
}
case R.id.mention:
{
final Intent intent=new Intent(INTENT_ACTION_MENTION);
final Bundle bundle=new Bundle();
bundle.putParcelable(EXTRA_USER,user);
intent.putExtras(bundle);
startActivity(intent);
break;
}
case R.id.send_direct_message:
{
final Uri.Builder builder=new Uri.Builder();
builder.scheme(SCHEME_TWIDERE);
builder.authority(AUTHORITY_DIRECT_MESSAGES_CONVERSATION);
builder.appendQueryParameter(QUERY_PARAM_ACCOUNT_KEY,user.account_key.toString());
builder.appendQueryParameter(QUERY_PARAM_USER_KEY,user.key.toString());
final Intent intent=new Intent(Intent.ACTION_VIEW,builder.build());
intent.putExtra(EXTRA_ACCOUNT,ParcelableCredentialsUtils.getCredentials(getActivity(),user.account_key));
intent.putExtra(EXTRA_USER,user);
startActivity(intent);
break;
}
case R.id.set_color:
{
final Intent intent=new Intent(getActivity(),ColorPickerDialogActivity.class);
intent.putExtra(EXTRA_COLOR,mUserColorNameManager.getUserColor(user.key));
intent.putExtra(EXTRA_ALPHA_SLIDER,false);
intent.putExtra(EXTRA_CLEAR_BUTTON,true);
startActivityForResult(intent,REQUEST_SET_COLOR);
break;
}
case R.id.clear_nickname:
{
mUserColorNameManager.clearUserNickname(user.key);
break;
}
case R.id.set_nickname:
{
final String nick=mUserColorNameManager.getUserNickname(user.key);
SetUserNicknameDialogFragment.show(getFragmentManager(),user.key,nick);
break;
}
case R.id.add_to_list:
{
final Intent intent=new Intent(INTENT_ACTION_SELECT_USER_LIST);
intent.setClass(getActivity(),UserListSelectorActivity.class);
intent.putExtra(EXTRA_ACCOUNT_KEY,user.account_key);
intent.putExtra(EXTRA_SCREEN_NAME,DataStoreUtils.getAccountScreenName(getActivity(),user.account_key));
startActivityForResult(intent,REQUEST_ADD_TO_LIST);
break;
}
case R.id.open_with_account:
{
final Intent intent=new Intent(INTENT_ACTION_SELECT_ACCOUNT);
intent.setClass(getActivity(),AccountSelectorActivity.class);
intent.putExtra(EXTRA_SINGLE_SELECTION,true);
startActivityForResult(intent,REQUEST_SELECT_ACCOUNT);
break;
}
case R.id.follow:
{
if (userRelationship == null) return true;
final boolean updatingRelationship=twitter.isUpdatingRelationship(user.account_key,user.key);
if (!updatingRelationship) {
if (userRelationship.following) {
DestroyFriendshipDialogFragment.show(getFragmentManager(),user);
}
 else {
twitter.createFriendshipAsync(user.account_key,user.key);
}
}
return true;
}
case R.id.enable_retweets:
{
final boolean newState=!item.isChecked();
final FriendshipUpdate update=new FriendshipUpdate();
update.retweets(newState);
twitter.updateFriendship(user.account_key,user.key.getId(),update);
item.setChecked(newState);
return true;
}
case R.id.muted_users:
{
IntentUtils.openMutesUsers(getActivity(),user.account_key);
return true;
}
case R.id.blocked_users:
{
IntentUtils.openUserBlocks(getActivity(),user.account_key);
return true;
}
case R.id.incoming_friendships:
{
IntentUtils.openIncomingFriendships(getActivity(),user.account_key);
return true;
}
case R.id.user_mentions:
{
IntentUtils.openUserMentions(getActivity(),user.account_key,user.screen_name);
return true;
}
case R.id.saved_searches:
{
IntentUtils.openSavedSearches(getActivity(),user.account_key);
return true;
}
case R.id.scheduled_statuses:
{
IntentUtils.openScheduledStatuses(getActivity(),user.account_key);
return true;
}
case R.id.open_in_browser:
{
final Uri uri=LinkCreator.getUserWebLink(user);
if (uri != null) {
final Intent intent=new Intent(Intent.ACTION_VIEW,uri);
intent.addCategory(Intent.CATEGORY_BROWSABLE);
startActivity(intent);
}
return true;
}
default :
{
if (item.getIntent() != null) {
try {
startActivity(item.getIntent());
}
 catch (final ActivityNotFoundException e) {
Log.w(LOGTAG,e);
return false;
}
}
break;
}
}
return true;
}
