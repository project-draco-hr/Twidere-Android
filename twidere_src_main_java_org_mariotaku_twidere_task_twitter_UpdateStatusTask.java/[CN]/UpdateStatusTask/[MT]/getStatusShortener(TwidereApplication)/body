{
  final String shortenerComponent=preferences.getString(KEY_STATUS_SHORTENER,null);
  if (ServicePickerPreference.isNoneValue(shortenerComponent))   return null;
  final StatusShortenerInterface shortener=StatusShortenerInterface.getInstance(app,shortenerComponent);
  if (shortener == null)   throw new ShortenerNotFoundException();
  try {
    shortener.checkService(new AbsServiceInterface.CheckServiceAction(){
      @Override public void check(      @Nullable Bundle metaData) throws AbsServiceInterface.CheckServiceException {
        if (metaData == null)         throw new ExtensionVersionMismatchException();
        final String extensionVersion=metaData.getString(METADATA_KEY_EXTENSION_VERSION_STATUS_SHORTENER);
        if (!TextUtils.equals(extensionVersion,context.getString(R.string.status_shortener_service_interface_version))) {
          throw new ExtensionVersionMismatchException();
        }
      }
    }
);
  }
 catch (  AbsServiceInterface.CheckServiceException e) {
    if (e instanceof ExtensionVersionMismatchException) {
      throw new ShortenException(context.getString(R.string.shortener_version_incompatible));
    }
    throw new ShortenException(e);
  }
  return shortener;
}
