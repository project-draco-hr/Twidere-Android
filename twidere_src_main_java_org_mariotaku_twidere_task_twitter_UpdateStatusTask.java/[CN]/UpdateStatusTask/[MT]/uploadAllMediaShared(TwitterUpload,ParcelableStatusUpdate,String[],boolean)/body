{
  String[] mediaIds=new String[update.media.length];
  for (int i=0; i < update.media.length; i++) {
    ParcelableMediaUpdate media=update.media[i];
    final MediaUploadResponse resp;
    Body body=null;
    try {
      final int index=i;
      body=getBodyFromMedia(context.getContentResolver(),Uri.parse(media.uri),new ContentLengthInputStream.ReadListener(){
        @Override public void onRead(        long length,        long position){
          stateCallback.onUploadingProgressChanged(index,position,length);
        }
      }
);
      if (chucked) {
        resp=uploadMediaChucked(upload,body,ownerIds);
      }
 else {
        resp=upload.uploadMedia(body,ownerIds);
      }
    }
 catch (    IOException e) {
      throw new UploadException(e);
    }
catch (    MicroBlogException e) {
      throw new UploadException(e);
    }
 finally {
      Utils.closeSilently(body);
    }
    mediaIds[i]=resp.getId();
  }
  return mediaIds;
}
