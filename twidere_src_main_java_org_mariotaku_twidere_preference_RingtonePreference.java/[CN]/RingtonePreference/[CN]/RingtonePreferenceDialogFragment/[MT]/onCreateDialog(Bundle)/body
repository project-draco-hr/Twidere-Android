{
  final Context context=getContext();
  final TypedArray a=context.obtainStyledAttributes(null,android.support.v7.appcompat.R.styleable.AlertDialog,android.support.v7.appcompat.R.attr.alertDialogStyle,0);
  @SuppressLint("PrivateResource") final int layout=a.getResourceId(android.support.v7.appcompat.R.styleable.AlertDialog_singleChoiceItemLayout,0);
  a.recycle();
  mAdapter=new SimpleCursorAdapter(context,layout,null,new String[]{Audio.Media.TITLE},new int[]{android.R.id.text1},0);
  final MaterialDialog.Builder builder=new MaterialDialog.Builder(context);
  builder.title(getPreference().getDialogTitle());
  builder.positiveText(android.R.string.ok);
  builder.negativeText(android.R.string.cancel);
  builder.onPositive(new MaterialDialog.SingleButtonCallback(){
    @Override public void onClick(    @NonNull MaterialDialog materialDialog,    @NonNull DialogAction dialogAction){
      RingtonePreferenceDialogFragment.this.onClick(materialDialog,DialogInterface.BUTTON_POSITIVE);
    }
  }
);
  builder.onNegative(new MaterialDialog.SingleButtonCallback(){
    @Override public void onClick(    @NonNull MaterialDialog materialDialog,    @NonNull DialogAction dialogAction){
      RingtonePreferenceDialogFragment.this.onClick(materialDialog,DialogInterface.BUTTON_NEGATIVE);
    }
  }
);
  builder.cancelListener(new DialogInterface.OnCancelListener(){
    @Override public void onCancel(    DialogInterface dialog){
      RingtonePreferenceDialogFragment.this.onClick(dialog,DialogInterface.BUTTON_NEGATIVE);
    }
  }
);
  int checkedItem=-1;
  builder.adapter(mAdapter,new MaterialDialog.ListCallback(){
    @Override public void onSelection(    MaterialDialog dialog,    View view,    int which,    CharSequence text){
      if (mMediaPlayer != null) {
        if (mMediaPlayer.isPlaying()) {
          mMediaPlayer.stop();
        }
        mMediaPlayer.release();
      }
      final Cursor cursor=mAdapter.getCursor();
      if (!cursor.moveToPosition(which))       return;
      mMediaPlayer=new MediaPlayer();
      mMediaPlayer.setLooping(false);
      final String ringtone=cursor.getString(cursor.getColumnIndex(Audio.Media.DATA));
      final Uri defUri=RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);
      final Uri uri=isEmpty(ringtone) ? defUri : Uri.parse(ringtone);
      mCurrentUri=uri;
      try {
        mMediaPlayer.setDataSource(getContext(),uri);
        mMediaPlayer.prepare();
        mMediaPlayer.start();
      }
 catch (      final Exception e) {
      }
    }
  }
);
  getLoaderManager().initLoader(0,null,this);
  return builder.build();
}
