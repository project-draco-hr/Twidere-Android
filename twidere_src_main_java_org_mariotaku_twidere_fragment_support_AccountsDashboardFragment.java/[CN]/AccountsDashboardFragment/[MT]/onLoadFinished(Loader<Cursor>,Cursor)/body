{
  final Menu menu=mAccountsToggleMenu.getMenu();
  mAccountActionProvider=(SupportAccountActionProvider)MenuItemCompat.getActionProvider(menu.findItem(MENU_SELECT_ACCOUNT));
  mAccountActionProvider.setExclusive(false);
  final ParcelableAccount[] accounts=ParcelableAccount.getAccounts(data);
  final Set<Long> activatedIds=new HashSet<>();
  long defaultId=-1;
  for (  ParcelableAccount account : accounts) {
    if (account.is_activated) {
      if (defaultId < 0) {
        defaultId=account.account_id;
      }
      activatedIds.add(account.account_id);
    }
  }
  mAccountsAdapter.setAccounts(accounts);
  mAccountsAdapter.setSelectedAccountId(mPreferences.getLong(KEY_DEFAULT_ACCOUNT_ID,defaultId));
  mAccountOptionsAdapter.setSelectedAccount(mAccountsAdapter.getSelectedAccount());
  mAccountActionProvider.setAccounts(accounts);
  mAccountActionProvider.setSelectedAccountIds(ArrayUtils.toPrimitive(activatedIds.toArray(new Long[activatedIds.size()])));
  initAccountActionsAdapter(accounts);
  updateAccountOptionsSeparatorLabel(null);
  updateDefaultAccountState();
}
