{
  if (!(modeCompat instanceof ActionModeImpl))   return;
  try {
    WindowDecorActionBar actionBar=null;
    final Field[] fields=ActionModeImpl.class.getDeclaredFields();
    for (    Field field : fields) {
      if (WindowDecorActionBar.class.isAssignableFrom(field.getType())) {
        field.setAccessible(true);
        actionBar=(WindowDecorActionBar)field.get(modeCompat);
        break;
      }
    }
    if (actionBar == null)     return;
    final Context context=actionBar.getThemedContext();
    final Field contextViewField=WindowDecorActionBar.class.getDeclaredField("mContextView");
    contextViewField.setAccessible(true);
    final View contextView=(View)contextViewField.get(actionBar);
    if (!(contextView instanceof ActionBarContextView))     return;
    final ActionBarContextView actionBarContextView=(ActionBarContextView)contextView;
    final TextView actionBarTitleView=(TextView)contextView.findViewById(android.support.v7.appcompat.R.id.action_bar_title);
    final TextView actionBarSubtitleView=(TextView)contextView.findViewById(android.support.v7.appcompat.R.id.action_bar_subtitle);
    final ImageView actionModeCloseButton=(ImageView)contextView.findViewById(android.support.v7.appcompat.R.id.action_mode_close_button);
    final ActionMenuView menuView=ViewUtils.findViewByType(contextView,ActionMenuView.class);
    final int actionBarColor;
    if (isDarkTheme(themeRes)) {
      actionBarColor=context.getResources().getColor(R.color.background_color_action_bar_dark);
    }
 else {
      actionBarColor=accentColor;
    }
    final int titleColor=getContrastActionBarTitleColor(context,themeRes,actionBarColor);
    final int itemColor=getContrastActionBarItemColor(context,themeRes,actionBarColor);
    if (actionBarTitleView != null) {
      actionBarTitleView.setTextColor(titleColor);
    }
    if (actionBarSubtitleView != null) {
      actionBarSubtitleView.setTextColor(titleColor);
    }
    if (actionModeCloseButton != null) {
      actionModeCloseButton.setColorFilter(itemColor,Mode.SRC_ATOP);
    }
    if (menuView != null) {
      setActionBarOverflowColor(menuView,itemColor);
      ThemeUtils.wrapToolbarMenuIcon(menuView,itemColor,itemColor);
    }
    ViewUtils.setBackground(contextView,getActionBarBackground(activity,themeRes,accentColor,backgroundOption,outlineEnabled));
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
