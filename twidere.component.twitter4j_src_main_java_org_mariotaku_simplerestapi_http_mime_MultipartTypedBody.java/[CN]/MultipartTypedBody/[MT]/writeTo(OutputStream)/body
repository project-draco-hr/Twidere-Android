{
  for (  Pair<String,TypedData> part : parts) {
    os.write(DASHDASH);
    os.write(boundary.getBytes());
    os.write(CRLF);
    final ContentType contentDisposition=new ContentType("form-data").parameter("name",part.first);
    final ContentType contentType=part.second.contentType();
    final long contentLength=part.second.length();
    if (part.second instanceof FileTypedData) {
      contentDisposition.addParameter("filename",((FileTypedData)part.second).fileName());
    }
    os.write("Content-Disposition".getBytes());
    os.write(COLONSPACE);
    os.write(contentDisposition.toHeader().getBytes());
    os.write(CRLF);
    if (contentType != null) {
      os.write("Content-Type".getBytes());
      os.write(COLONSPACE);
      os.write(contentType.toHeader().getBytes());
      os.write(CRLF);
    }
    if (contentLength != -1) {
      os.write("Content-Length".getBytes());
      os.write(COLONSPACE);
      os.write(String.valueOf(contentLength).getBytes());
      os.write(CRLF);
    }
    os.write(CRLF);
    part.second.writeTo(os);
    os.write(CRLF);
  }
  os.write(DASHDASH);
  os.write(boundary.getBytes());
  os.write(DASHDASH);
  os.write(CRLF);
}
