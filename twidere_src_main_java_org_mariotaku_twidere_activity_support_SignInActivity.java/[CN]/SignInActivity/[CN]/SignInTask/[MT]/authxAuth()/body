{
  final String versionSuffix=noVersionSuffix ? null : "1.1";
  final Endpoint endpoint=new Endpoint(Utils.getApiUrl(apiUrlFormat,"api",versionSuffix));
  OAuthAuthorization auth=new OAuthAuthorization(consumerKey.getOauthToken(),consumerKey.getOauthTokenSecret());
  final TwitterOAuth oauth=TwitterAPIUtils.getInstance(context,endpoint,auth,TwitterOAuth.class);
  final OAuthToken accessToken=oauth.getAccessToken(username,password,TwitterOAuth.XAuthMode.CLIENT);
  final long userId=accessToken.getUserId();
  if (userId <= 0)   return new SignInResponse(false,false,null);
  if (isUserLoggedIn(context,userId))   return new SignInResponse(true,false,null);
  auth=new OAuthAuthorization(consumerKey.getOauthToken(),consumerKey.getOauthTokenSecret(),accessToken);
  final Twitter twitter=TwitterAPIUtils.getInstance(context,endpoint,auth,Twitter.class);
  final User user=twitter.verifyCredentials();
  final int color=analyseUserProfileColor(user);
  return new SignInResponse(auth,user,Accounts.AUTH_TYPE_XAUTH,color,apiUrlFormat,sameOAuthSigningUrl,noVersionSuffix);
}
