{
  final String app_root=file.getParent();
  final File tmp_dir=new File(app_root + "/spice");
  if (!tmp_dir.exists()) {
    if (!tmp_dir.mkdirs()) {
      SpiceProfilingUtil.log("cannot create folder spice, do nothing.");
      return;
    }
  }
  final File tmp=new File(tmp_dir,file.getName());
  file.renameTo(tmp);
  try {
    final RestHttpRequest.Builder builder=new RestHttpRequest.Builder();
    builder.url(PROFILE_SERVER_URL);
    builder.method(POST.METHOD);
    final MultipartTypedBody body=new MultipartTypedBody();
    body.add("file",new FileTypedData(tmp));
    builder.body(body);
    final RestHttpResponse response=client.execute(builder.build());
    if (response.isSuccessful()) {
      SpiceProfilingUtil.log("server has already received file " + tmp.getName());
      tmp.delete();
    }
    throw new IOException("Unable to send file");
  }
 catch (  Exception e) {
    if (BuildConfig.DEBUG) {
      Log.w(LOGTAG,e);
      SpiceProfilingUtil.log("server does not receive file " + tmp.getName());
    }
    putBackProfile(context,tmp,file);
  }
}
