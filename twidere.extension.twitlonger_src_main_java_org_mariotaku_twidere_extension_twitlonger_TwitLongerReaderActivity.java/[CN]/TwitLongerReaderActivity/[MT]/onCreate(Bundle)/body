{
  requestWindowFeature(Window.FEATURE_NO_TITLE);
  super.onCreate(savedInstanceState);
  final Intent intent=getIntent();
  final Uri data=intent.getData();
  final String action=intent.getAction();
  setContentView(R.layout.main);
  mPreview=(TextView)findViewById(R.id.text);
  mActionButton=(ImageButton)findViewById(R.id.action);
  mProgress=(ProgressBar)findViewById(R.id.progress);
  mResult=savedInstanceState != null ? savedInstanceState.getString(Twidere.EXTRA_TEXT) : null;
  mUser=savedInstanceState != null ? savedInstanceState.getString(Twidere.EXTRA_USER) : null;
  if (mResult == null || mUser == null) {
    if (Twidere.INTENT_ACTION_EXTENSION_OPEN_STATUS.equals(action)) {
      mStatus=Twidere.getStatusFromIntent(getIntent());
      if (mStatus == null || mStatus.spans == null) {
        finish();
        return;
      }
      mUser=mStatus.user_screen_name;
      mPreview.setText(mStatus.text_unescaped);
      mActionButton.setEnabled(false);
      for (      SpanItem span : mStatus.spans) {
        final Matcher m=PATTERN_TWITLONGER.matcher(span.link);
        if (m.find()) {
          mActionButton.setEnabled(true);
          break;
        }
      }
    }
 else     if (Intent.ACTION_VIEW.equals(action) && data != null) {
      mPreview.setText(data.toString());
      final Matcher m=PATTERN_TWITLONGER.matcher(data.toString());
      if (m.find()) {
        if (mTwitLongerPostTask != null) {
          mTwitLongerPostTask.cancel(true);
        }
        mTwitLongerPostTask=new TwitLongerReaderTask(this);
        mTwitLongerPostTask.execute(m.group(GROUP_TWITLONGER_ID));
      }
 else {
        finish();
        return;
      }
    }
  }
 else {
    mPreview.setText(mResult);
  }
}
