{
  super.onCreate();
  mAlarmManager=(AlarmManager)getSystemService(ALARM_SERVICE);
  final TwidereApplication app=TwidereApplication.getInstance(this);
  mTwitterWrapper=app.getTwitterWrapper();
  mPreferences=SharedPreferencesWrapper.getInstance(app,SHARED_PREFERENCES_NAME,MODE_PRIVATE);
  mPendingRefreshHomeTimelineIntent=PendingIntent.getBroadcast(this,0,new Intent(BROADCAST_REFRESH_HOME_TIMELINE),0);
  mPendingRefreshMentionsIntent=PendingIntent.getBroadcast(this,0,new Intent(BROADCAST_REFRESH_MENTIONS),0);
  mPendingRefreshDirectMessagesIntent=PendingIntent.getBroadcast(this,0,new Intent(BROADCAST_REFRESH_DIRECT_MESSAGES),0);
  mPendingRefreshTrendsIntent=PendingIntent.getBroadcast(this,0,new Intent(BROADCAST_REFRESH_TRENDS),0);
  final IntentFilter refreshFilter=new IntentFilter(BROADCAST_NOTIFICATION_DELETED);
  refreshFilter.addAction(BROADCAST_REFRESH_HOME_TIMELINE);
  refreshFilter.addAction(BROADCAST_REFRESH_MENTIONS);
  refreshFilter.addAction(BROADCAST_REFRESH_DIRECT_MESSAGES);
  refreshFilter.addAction(BROADCAST_RESCHEDULE_HOME_TIMELINE_REFRESHING);
  refreshFilter.addAction(BROADCAST_RESCHEDULE_MENTIONS_REFRESHING);
  refreshFilter.addAction(BROADCAST_RESCHEDULE_DIRECT_MESSAGES_REFRESHING);
  registerReceiver(mStateReceiver,refreshFilter);
  final IntentFilter batteryFilter=new IntentFilter();
  refreshFilter.addAction(Intent.ACTION_BATTERY_CHANGED);
  refreshFilter.addAction(Intent.ACTION_BATTERY_OKAY);
  refreshFilter.addAction(Intent.ACTION_BATTERY_LOW);
  refreshFilter.addAction(Intent.ACTION_POWER_CONNECTED);
  refreshFilter.addAction(Intent.ACTION_POWER_DISCONNECTED);
  registerReceiver(mBatteryReceiver,batteryFilter);
  startAutoRefresh();
}
