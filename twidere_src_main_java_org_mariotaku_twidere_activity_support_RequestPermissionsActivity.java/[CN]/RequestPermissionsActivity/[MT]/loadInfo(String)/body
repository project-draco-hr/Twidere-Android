{
  final PackageManager pm=getPackageManager();
  try {
    final ApplicationInfo info=pm.getApplicationInfo(pname,PackageManager.GET_META_DATA);
    final Bundle meta=info.metaData;
    if (meta == null || !meta.getBoolean(METADATA_KEY_EXTENSION)) {
      setResult(RESULT_CANCELED);
      finish();
      return;
    }
    mIconView.setImageDrawable(info.loadIcon(pm));
    mNameView.setText(info.loadLabel(pm));
    final CharSequence desc=info.loadDescription(pm);
    mDescriptionView.setText(desc);
    mDescriptionView.setVisibility(isEmpty(desc) ? View.GONE : View.VISIBLE);
    final String[] permissions=PermissionsManager.parsePermissions(meta.getString(METADATA_KEY_EXTENSION_PERMISSIONS));
    mPermissions=permissions;
    mCallingPackage=pname;
    final SpannableStringBuilder builder=new SpannableStringBuilder();
    builder.append(HtmlEscapeHelper.escape(getString(R.string.permissions_request_message)));
    builder.append("\n");
    if (PermissionsManager.isPermissionValid(permissions)) {
      if (PermissionsManager.hasPermissions(permissions,PERMISSION_PREFERENCES)) {
        appendPermission(builder,getString(R.string.permission_description_preferences),true);
      }
      if (PermissionsManager.hasPermissions(permissions,PERMISSION_ACCOUNTS)) {
        appendPermission(builder,getString(R.string.permission_description_accounts),true);
      }
      if (PermissionsManager.hasPermissions(permissions,PERMISSION_DIRECT_MESSAGES)) {
        appendPermission(builder,getString(R.string.permission_description_direct_messages),true);
      }
      if (PermissionsManager.hasPermissions(permissions,PERMISSION_WRITE)) {
        appendPermission(builder,getString(R.string.permission_description_write),false);
      }
      if (PermissionsManager.hasPermissions(permissions,PERMISSION_READ)) {
        appendPermission(builder,getString(R.string.permission_description_read),false);
      }
      if (PermissionsManager.hasPermissions(permissions,PERMISSION_REFRESH)) {
        appendPermission(builder,getString(R.string.permission_description_refresh),false);
      }
    }
 else {
      appendPermission(builder,getString(R.string.permission_description_none),false);
    }
    mMessageView.setText(builder);
  }
 catch (  final NameNotFoundException e) {
    setResult(RESULT_CANCELED);
    finish();
  }
}
