{
  final OAuthEndpoint endpoint=new OAuthEndpoint(conf.getRestBaseURL(),conf.getSigningRestBaseURL());
  final RestAPIFactory factory=new RestAPIFactory();
  factory.setClient(new OkHttpRestClient(createHttpClient(conf)));
  factory.setConverter(new TwitterConverter());
  factory.setEndpoint(endpoint);
  factory.setAuthorization(auth);
  factory.setRequestFactory(new RestRequest.Factory(){
    @Override public RestRequest create(    @NonNull Endpoint endpoint,    @NonNull RestMethodInfo info,    @Nullable Authorization authorization){
      final RestMethod restMethod=info.getMethod();
      final String url=Endpoint.constructUrl(endpoint.getUrl(),info);
      final ArrayList<Pair<String,String>> headers=new ArrayList<>(info.getHeaders());
      if (authorization != null && authorization.hasAuthorization()) {
        headers.add(Pair.create("Authorization",authorization.getHeader(endpoint,info)));
      }
      headers.add(Pair.create("User-Agent",conf.getHttpUserAgent()));
      return new RestRequest(restMethod.value(),url,headers,info.getBody(),null);
    }
  }
);
  return factory.build(Twitter.class);
}
