{
  final Drawable drawable=getDrawable();
  if (drawable == null)   return 0;
  paint.getFontMetrics(fontMetrics);
  final int textHeightPx=Math.round(fontMetrics.descent - fontMetrics.ascent);
  final float intrinsicWidth=drawable.getIntrinsicWidth(), intrinsicHeight=drawable.getIntrinsicHeight();
  final int scaledWidth;
  if (intrinsicWidth > intrinsicHeight) {
    scaledWidth=Math.round(textHeightPx * (intrinsicWidth / intrinsicHeight));
  }
 else {
    scaledWidth=Math.round(intrinsicWidth * (textHeightPx / intrinsicHeight));
  }
  final int top=Math.round(fontMetrics.bottom) - textHeightPx, left=0;
  drawable.setBounds(left,top,left + scaledWidth,top + textHeightPx);
  return scaledWidth;
}
