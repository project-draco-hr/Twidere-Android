{
  final Drawable drawable=getDrawable();
  if (drawable == null)   return 0;
  final int textHeightPx=Math.round(paint.descent() - paint.ascent());
  final float intrinsicWidth=drawable.getIntrinsicWidth(), intrinsicHeight=drawable.getIntrinsicHeight();
  final int scaledWidth;
  if (intrinsicWidth > intrinsicHeight) {
    scaledWidth=Math.round(textHeightPx * (intrinsicWidth / intrinsicHeight));
  }
 else {
    scaledWidth=Math.round(intrinsicWidth * (textHeightPx / intrinsicHeight));
  }
  if (fm == null) {
    fm=paint.getFontMetricsInt();
  }
  final int top=fm.bottom - textHeightPx, left=0;
  drawable.setBounds(left,top,left + scaledWidth,top + textHeightPx);
  return scaledWidth;
}
