{
  String uriString=uri.toString();
  BitmapFactory.Options options=new BitmapFactory.Options();
  Bitmap bitmap;
  options.inPreferredConfig=Bitmap.Config.ARGB_8888;
  if (uriString.startsWith(RESOURCE_PREFIX)) {
    Resources res;
    String packageName=uri.getAuthority();
    if (context.getPackageName().equals(packageName)) {
      res=context.getResources();
    }
 else {
      PackageManager pm=context.getPackageManager();
      res=pm.getResourcesForApplication(packageName);
    }
    int id=0;
    List<String> segments=uri.getPathSegments();
    int size=segments.size();
    if (size == 2 && segments.get(0).equals("drawable")) {
      String resName=segments.get(1);
      id=res.getIdentifier(resName,"drawable",packageName);
    }
 else     if (size == 1 && TextUtils.isDigitsOnly(segments.get(0))) {
      try {
        id=Integer.parseInt(segments.get(0));
      }
 catch (      NumberFormatException ignored) {
      }
    }
    bitmap=BitmapFactory.decodeResource(context.getResources(),id,options);
  }
 else   if (uriString.startsWith(ASSET_PREFIX)) {
    String assetName=uriString.substring(ASSET_PREFIX.length());
    bitmap=BitmapFactory.decodeStream(context.getAssets().open(assetName),null,options);
  }
 else   if (uriString.startsWith(FILE_PREFIX)) {
    bitmap=BitmapFactory.decodeFile(uriString.substring(FILE_PREFIX.length()),options);
  }
 else   if (uriString.startsWith(CACHE_PREFIX)) {
    InputStream inputStream=null;
    try {
      final SimpleDiskCache.InputStreamEntry entry=mSimpleDiskCache.getInputStream(ByteString.decodeBase64(uri.getSchemeSpecificPart()).utf8());
      if (entry != null) {
        inputStream=entry.getInputStream();
        bitmap=BitmapFactory.decodeStream(inputStream,null,options);
      }
 else {
        throw new FileNotFoundException(uriString);
      }
    }
  finally {
      Utils.closeSilently(inputStream);
    }
  }
 else {
    InputStream inputStream=null;
    try {
      ContentResolver contentResolver=context.getContentResolver();
      inputStream=contentResolver.openInputStream(uri);
      bitmap=BitmapFactory.decodeStream(inputStream,null,options);
    }
  finally {
      if (inputStream != null) {
        try {
          inputStream.close();
        }
 catch (        Exception ignored) {
        }
      }
    }
  }
  if (bitmap == null) {
    throw new RuntimeException("Skia image region decoder returned null bitmap - image format may not be supported");
  }
  return bitmap;
}
