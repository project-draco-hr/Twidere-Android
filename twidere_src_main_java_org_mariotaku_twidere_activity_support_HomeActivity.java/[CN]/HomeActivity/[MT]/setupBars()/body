{
  final int themeColor=getThemeColor();
  final int themeResId=getCurrentThemeResourceId();
  final String backgroundOption=getCurrentThemeBackgroundOption();
  final boolean isTransparent=ThemeUtils.isTransparentBackground(backgroundOption);
  final int actionBarAlpha=isTransparent ? ThemeUtils.getUserThemeBackgroundAlpha(this) : 0xFF;
  final IHomeActionButton homeActionButton=(IHomeActionButton)mActionsButton;
  mTabIndicator.setItemContext(ThemeUtils.getActionBarThemedContext(this,themeResId,themeColor));
  ViewSupport.setBackground(mActionBar,ThemeUtils.getActionBarBackground(this,themeResId,themeColor,backgroundOption,true));
  final int statusBarColor;
  final Resources resources=getResources();
  final int[] foregroundColors=new int[2];
  ThemeUtils.getColorForegroundAndInverse(this,foregroundColors);
  if (ThemeUtils.isDarkTheme(themeResId)) {
    statusBarColor=getResources().getColor(R.color.background_color_action_bar_dark);
    homeActionButton.setButtonColor(statusBarColor);
    homeActionButton.setIconColor(resources.getColor(R.color.action_icon_light),Mode.SRC_ATOP);
    mTabIndicator.setStripColor(themeColor);
    mTabIndicator.setIconColor(foregroundColors[0]);
    mTabIndicator.setLabelColor(foregroundColors[0]);
  }
 else {
    statusBarColor=themeColor;
    final int colorDark=resources.getColor(R.color.action_icon_dark);
    final int colorLight=resources.getColor(R.color.action_icon_light);
    final int actionItemColor=TwidereColorUtils.getContrastYIQ(themeColor,ThemeUtils.ACCENT_COLOR_THRESHOLD,colorDark,colorLight);
    final int contrastColor=TwidereColorUtils.getContrastYIQ(themeColor,ThemeUtils.ACCENT_COLOR_THRESHOLD,foregroundColors[0],foregroundColors[1]);
    homeActionButton.setButtonColor(themeColor);
    homeActionButton.setIconColor(actionItemColor,Mode.SRC_ATOP);
    mTabIndicator.setStripColor(contrastColor);
    mTabIndicator.setIconColor(contrastColor);
    mTabIndicator.setLabelColor(contrastColor);
    ActivitySupport.setTaskDescription(this,new TaskDescriptionCompat(null,null,themeColor));
  }
  mColorStatusFrameLayout.setDrawColor(true);
  mColorStatusFrameLayout.setDrawShadow(false);
  mColorStatusFrameLayout.setColor(statusBarColor,actionBarAlpha);
  StatusBarProxy.setStatusBarDarkIcon(getWindow(),TwidereColorUtils.getYIQLuminance(statusBarColor) > ThemeUtils.ACCENT_COLOR_THRESHOLD);
  mColorStatusFrameLayout.setFactor(1);
  mTabIndicator.setAlpha(actionBarAlpha / 255f);
  mActionsButton.setAlpha(actionBarAlpha / 255f);
}
