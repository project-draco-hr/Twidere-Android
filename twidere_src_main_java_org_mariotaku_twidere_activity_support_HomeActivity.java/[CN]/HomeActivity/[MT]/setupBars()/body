{
  final int themeColor=getThemeColor();
  final int themeResId=getCurrentThemeResourceId();
  final boolean isTransparent=ThemeUtils.isTransparentBackground(themeResId);
  final int actionBarAlpha=isTransparent ? ThemeUtils.getUserThemeBackgroundAlpha(this) : 0xFF;
  final IHomeActionButton homeActionButton=(IHomeActionButton)mActionsButton;
  mTabIndicator.setItemContext(ThemeUtils.getActionBarContext(this));
  if (ThemeUtils.isColoredActionBar(themeResId)) {
    final int contrastColor=ColorUtils.getContrastYIQ(themeColor,192);
    ViewAccessor.setBackground(mActionBar,new ColorDrawable(themeColor));
    homeActionButton.setButtonColor(themeColor);
    homeActionButton.setIconColor(contrastColor,Mode.SRC_ATOP);
    mTabIndicator.setStripColor(contrastColor);
    mTabIndicator.setIconColor(contrastColor);
    ActivityAccessor.setTaskDescription(this,new TaskDescriptionCompat(null,null,themeColor));
    mColorStatusFrameLayout.setDrawColor(true);
    mColorStatusFrameLayout.setDrawShadow(false);
    mColorStatusFrameLayout.setColor(themeColor,actionBarAlpha);
    mColorStatusFrameLayout.setFactor(1);
  }
 else {
    final int backgroundColor=ThemeUtils.getThemeBackgroundColor(mTabIndicator.getItemContext());
    final int foregroundColor=ThemeUtils.getThemeForegroundColor(mTabIndicator.getItemContext());
    ViewAccessor.setBackground(mActionBar,ThemeUtils.getActionBarBackground(this,themeResId));
    homeActionButton.setButtonColor(backgroundColor);
    homeActionButton.setIconColor(foregroundColor,Mode.SRC_ATOP);
    mTabIndicator.setStripColor(themeColor);
    mTabIndicator.setIconColor(foregroundColor);
    mColorStatusFrameLayout.setDrawColor(false);
    mColorStatusFrameLayout.setDrawShadow(false);
  }
  mTabIndicator.setAlpha(actionBarAlpha / 255f);
  mActionsButton.setAlpha(actionBarAlpha / 255f);
  ViewAccessor.setBackground(mActionBarOverlay,ThemeUtils.getWindowContentOverlay(this));
}
