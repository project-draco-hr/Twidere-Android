{
  final int themeColor=getThemeColor();
  final int themeResId=getCurrentThemeResourceId();
  final String backgroundOption=getCurrentThemeBackgroundOption();
  final boolean isTransparent=ThemeUtils.isTransparentBackground(backgroundOption);
  final int actionBarAlpha=isTransparent ? ThemeUtils.getUserThemeBackgroundAlpha(this) : 0xFF;
  final IHomeActionButton homeActionButton=(IHomeActionButton)mActionsButton;
  mTabIndicator.setItemContext(ThemeUtils.getActionBarContext(this));
  ViewUtils.setBackground(mActionBar,ThemeUtils.getActionBarBackground(this,themeResId,themeColor,backgroundOption,true));
  if (ThemeUtils.isDarkTheme(themeResId)) {
    final int backgroundColor=ThemeUtils.getThemeBackgroundColor(mTabIndicator.getItemContext());
    final int foregroundColor=ThemeUtils.getThemeForegroundColor(mTabIndicator.getItemContext());
    homeActionButton.setButtonColor(backgroundColor);
    homeActionButton.setIconColor(foregroundColor,Mode.SRC_ATOP);
    mTabIndicator.setStripColor(themeColor);
    mTabIndicator.setIconColor(foregroundColor);
    mTabIndicator.setLabelColor(foregroundColor);
    mColorStatusFrameLayout.setDrawColor(true);
    mColorStatusFrameLayout.setDrawShadow(false);
    mColorStatusFrameLayout.setColor(getResources().getColor(R.color.background_color_action_bar_dark),actionBarAlpha);
    mColorStatusFrameLayout.setFactor(1);
  }
 else {
    final int contrastColor=TwidereColorUtils.getContrastYIQ(themeColor,192);
    homeActionButton.setButtonColor(themeColor);
    homeActionButton.setIconColor(contrastColor,Mode.SRC_ATOP);
    mTabIndicator.setStripColor(contrastColor);
    mTabIndicator.setIconColor(contrastColor);
    mTabIndicator.setLabelColor(contrastColor);
    ActivityAccessor.setTaskDescription(this,new TaskDescriptionCompat(null,null,themeColor));
    mColorStatusFrameLayout.setDrawColor(true);
    mColorStatusFrameLayout.setDrawShadow(false);
    mColorStatusFrameLayout.setColor(themeColor,actionBarAlpha);
    mColorStatusFrameLayout.setFactor(1);
  }
  mTabIndicator.setAlpha(actionBarAlpha / 255f);
  mActionsButton.setAlpha(actionBarAlpha / 255f);
  ViewUtils.setBackground(mActionBarOverlay,ThemeUtils.getWindowContentOverlay(this));
}
