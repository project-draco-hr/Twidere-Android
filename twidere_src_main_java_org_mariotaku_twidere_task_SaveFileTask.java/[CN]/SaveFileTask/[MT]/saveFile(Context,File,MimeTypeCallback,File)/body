{
  Source ioSrc=null;
  BufferedSink sink=null;
  try {
    final String name=source.getName();
    if (isEmpty(name))     return null;
    final String mimeType=mimeTypeCallback.getMimeType(source);
    final String extension=mimeTypeCallback.getExtension(mimeType);
    if (extension == null)     return null;
    final String nameToSave=getFileNameWithExtension(name,extension);
    if (!destinationDir.isDirectory() && !destinationDir.mkdirs())     return null;
    final File saveFile=new File(destinationDir,nameToSave);
    ioSrc=Okio.source(source);
    sink=Okio.buffer(Okio.sink(saveFile));
    sink.writeAll(ioSrc);
    sink.flush();
    return new SaveFileResult(saveFile,mimeType);
  }
 catch (  final IOException e) {
    Log.w(LOGTAG,"Failed to save file",e);
    return null;
  }
 finally {
    Utils.closeSilently(sink);
    Utils.closeSilently(ioSrc);
  }
}
