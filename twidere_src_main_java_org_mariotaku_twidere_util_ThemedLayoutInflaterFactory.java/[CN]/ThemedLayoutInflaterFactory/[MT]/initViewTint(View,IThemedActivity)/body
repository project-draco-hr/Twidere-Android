{
  final int noTintColor, accentColor, backgroundTintColor;
  final boolean isColorTint;
  final Resources resources=((Activity)activity).getResources();
  final Context viewContext=view.getContext();
  final boolean isActionBarContext=isActionBarContext(viewContext,getActionBarContext((Activity)activity));
  final int themeResourceId=activity.getCurrentThemeResourceId();
  final boolean isDarkTheme=ThemeUtils.isDarkTheme(themeResourceId);
  final int backgroundColorApprox;
  if (!isActionBarContext) {
    accentColor=activity.getCurrentThemeColor();
    final int[] darkLightColors=new int[2];
    ThemeUtils.getDarkLightForegroundColors((Context)activity,activity.getCurrentThemeResourceId(),darkLightColors);
    noTintColor=TwidereColorUtils.getContrastYIQ(accentColor,ThemeUtils.ACCENT_COLOR_THRESHOLD,darkLightColors[0],darkLightColors[1]);
    backgroundTintColor=accentColor;
    backgroundColorApprox=isDarkTheme ? Color.BLACK : Color.WHITE;
    isColorTint=true;
  }
 else   if (isDarkTheme) {
    noTintColor=Color.WHITE;
    accentColor=activity.getCurrentThemeColor();
    backgroundTintColor=noTintColor;
    backgroundColorApprox=Color.BLACK;
    isColorTint=true;
  }
 else {
    final int actionBarColor=activity.getCurrentThemeColor();
    accentColor=ThemeUtils.getColorFromAttribute(viewContext,android.R.attr.colorForeground,0);
    noTintColor=ThemeUtils.getColorFromAttribute(viewContext,android.R.attr.colorBackground,0);
    backgroundTintColor=accentColor;
    backgroundColorApprox=Color.WHITE;
    isColorTint=false;
  }
  final boolean isAccentOptimal=Math.abs(TwidereColorUtils.getYIQContrast(backgroundColorApprox,accentColor)) > 64;
  if (view instanceof TextView) {
    final TextView textView=(TextView)view;
    if (isAccentOptimal) {
      textView.setLinkTextColor(accentColor);
    }
  }
  if (view instanceof IThemeAccentView) {
    if (isAccentOptimal || !isColorTint) {
      ((IThemeAccentView)view).setAccentTintColor(ColorStateList.valueOf(accentColor));
    }
 else {
      final int defaultAccentColor=ThemeUtils.getColorFromAttribute(viewContext,R.attr.colorAccent,resources.getColor(R.color.branding_color));
      ((IThemeAccentView)view).setAccentTintColor(ColorStateList.valueOf(defaultAccentColor));
    }
  }
 else   if (view instanceof IThemeBackgroundTintView) {
    if (isAccentOptimal || !isColorTint) {
      ((IThemeBackgroundTintView)view).setBackgroundTintColor(ColorStateList.valueOf(backgroundTintColor));
    }
  }
 else   if (view instanceof TwidereToolbar) {
    if (viewContext instanceof ContextThemeWrapper) {
      ((TwidereToolbar)view).setItemColor(ThemeUtils.getThemeForegroundColor(viewContext,((ContextThemeWrapper)viewContext).getThemeResId()));
    }
 else {
      ((TwidereToolbar)view).setItemColor(ThemeUtils.getThemeForegroundColor(viewContext));
    }
  }
 else   if (view instanceof EditText) {
    if (isAccentOptimal || !isColorTint) {
      ViewCompat.setBackgroundTintList(view,ColorStateList.valueOf(backgroundTintColor));
    }
    if (view instanceof MaterialEditText) {
      if (isAccentOptimal || !isColorTint) {
        ((MaterialEditText)view).setPrimaryColor(backgroundTintColor);
      }
    }
  }
 else   if (view instanceof ProgressBar) {
    if (isAccentOptimal || !isColorTint) {
      ViewSupport.setIndeterminateTintList((ProgressBar)view,ColorStateList.valueOf(accentColor));
      ViewSupport.setProgressTintList((ProgressBar)view,ColorStateList.valueOf(accentColor));
      ViewSupport.setProgressBackgroundTintList((ProgressBar)view,ColorStateList.valueOf(accentColor));
    }
  }
 else   if (view instanceof TintableBackgroundView) {
    final TintableBackgroundView tintable=(TintableBackgroundView)view;
    if (isAccentOptimal || !isColorTint) {
      applyTintableBackgroundViewTint(tintable,accentColor,noTintColor,backgroundTintColor,isColorTint);
    }
  }
}
