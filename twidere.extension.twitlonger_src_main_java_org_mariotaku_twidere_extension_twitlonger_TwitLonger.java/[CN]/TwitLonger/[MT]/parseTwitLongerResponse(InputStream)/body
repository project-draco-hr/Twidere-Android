{
  try {
    final XmlPullParserFactory factory=XmlPullParserFactory.newInstance();
    factory.setNamespaceAware(true);
    final XmlPullParser parser=factory.newPullParser();
    parser.setInput(new InputStreamReader(response));
    int eventType=parser.getEventType();
    String tagName;
    boolean lookingForEndOfUnknownTag=false;
    String unknownTagName=null;
    do {
      if (eventType == XmlPullParser.START_TAG) {
        tagName=parser.getName();
        if (TAG_TWITLONGER.equals(tagName)) {
          eventType=parser.next();
          break;
        }
        throw new RuntimeException("Expecting " + TAG_TWITLONGER + " , got "+ tagName);
      }
      eventType=parser.next();
    }
 while (eventType != XmlPullParser.END_DOCUMENT);
    boolean endOfDocument=false;
    String id=null, link=null, short_link=null, content=null, user=null;
    while (!endOfDocument) {
switch (eventType) {
case XmlPullParser.START_TAG:
{
          if (lookingForEndOfUnknownTag) {
            break;
          }
          tagName=parser.getName();
          if (TAG_POST.equalsIgnoreCase(tagName)) {
          }
 else           if (TAG_ERROR.equalsIgnoreCase(tagName))           throw new TwitLongerException("Server returned error response: " + parser.nextText());
 else           if (TAG_ID.equalsIgnoreCase(tagName)) {
            id=parser.nextText();
          }
 else           if (TAG_LINK.equalsIgnoreCase(tagName)) {
            link=parser.nextText();
          }
 else           if (TAG_SHORT.equalsIgnoreCase(tagName)) {
            short_link=parser.nextText();
          }
 else           if (TAG_CONTENT.equalsIgnoreCase(tagName)) {
            content=parser.nextText();
          }
 else           if (TAG_USER.equalsIgnoreCase(tagName)) {
            user=parser.nextText();
          }
 else {
            lookingForEndOfUnknownTag=true;
            unknownTagName=tagName;
          }
          break;
        }
case XmlPullParser.END_TAG:
{
        tagName=parser.getName();
        if (lookingForEndOfUnknownTag && tagName.equals(unknownTagName)) {
          lookingForEndOfUnknownTag=false;
          unknownTagName=null;
        }
        break;
      }
case XmlPullParser.END_DOCUMENT:
{
      endOfDocument=true;
      if (id == null || content == null)       throw new TwitLongerException("Server returned unknown reponse.");
    }
}
eventType=parser.next();
}
return new TwitLongerResponse(id,content,link,short_link,user);
}
 catch (final IOException|XmlPullParserException e) {
throw new TwitLongerException(e);
}
}
