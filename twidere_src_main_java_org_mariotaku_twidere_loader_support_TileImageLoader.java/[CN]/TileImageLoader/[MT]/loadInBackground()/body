{
  if (mUri == null) {
    return Result.nullInstance();
  }
  final String scheme=mUri.getScheme();
  SimpleDiskCache.InputStreamEntry cacheEntry=null;
  if ("http".equals(scheme) || "https".equals(scheme)) {
    final String uriString=mUri.toString();
    if (uriString == null)     return Result.nullInstance();
    try {
      cacheEntry=mDiskCache.getInputStream(uriString);
    }
 catch (    IOException e) {
    }
    if (isValid(cacheEntry)) {
      return Result.getInstance(Uri.fromParts("cache",ByteString.encodeUtf8(uriString).base64Url(),null));
    }
    try {
      ContentLengthInputStream cis=null;
      final InputStream is=mDownloader.getStream(uriString,new AccountFullImageExtra(mAccountId));
      if (is == null)       return Result.nullInstance();
      try {
        final long length=is.available();
        mHandler.post(new DownloadStartRunnable(this,mListener,length));
        final Map<String,String> metadata=new HashMap<>();
        metadata.put("length",String.valueOf(length));
        cis=new ContentLengthInputStream(is,length);
        cis.setReadListener(new ContentLengthInputStream.ReadListener(){
          @Override public void onRead(          long length,          long position){
            mHandler.post(new ProgressUpdateRunnable(mListener,position));
          }
        }
);
        mDiskCache.put(uriString,cis,metadata);
        mHandler.post(new DownloadFinishRunnable(this,mListener));
      }
  finally {
        IoUtils.closeSilently(is);
      }
      cacheEntry=mDiskCache.getInputStream(uriString);
      if (isValid(cacheEntry)) {
        return Result.getInstance(Uri.fromParts("cache",ByteString.encodeUtf8(uriString).base64Url(),null));
      }
 else {
        mDiskCache.remove(uriString);
        throw new IOException();
      }
    }
 catch (    final Exception e) {
      mHandler.post(new DownloadErrorRunnable(this,mListener,e));
      return Result.getInstance(e);
    }
  }
  return Result.getInstance(mUri);
}
