{
  final Spannable buffer=SpannableString.valueOf(getText());
  final int action=event.getAction();
  if (action == MotionEvent.ACTION_UP || action == MotionEvent.ACTION_DOWN) {
    int x=(int)event.getX();
    int y=(int)event.getY();
    x-=getTotalPaddingLeft();
    y-=getTotalPaddingTop();
    x+=getScrollX();
    y+=getScrollY();
    final Layout layout=getLayout();
    final int line=layout.getLineForVertical(y);
    final int off=layout.getOffsetForHorizontal(line,x);
    final float lineWidth=layout.getLineWidth(line);
    final ClickableSpan[] links=buffer.getSpans(off,off,ClickableSpan.class);
    if (links.length != 0 && x <= lineWidth) {
      final ClickableSpan link=links[0];
      if (action == MotionEvent.ACTION_UP) {
        Selection.removeSelection(buffer);
        setClickable(false);
        link.onClick(this);
        return true;
      }
 else {
        Selection.setSelection(buffer,buffer.getSpanStart(link),buffer.getSpanEnd(link));
        setClickable(true);
      }
    }
 else {
      Selection.removeSelection(buffer);
      setClickable(false);
    }
  }
  return super.onTouchEvent(event);
}
