{
  final SignInActivity activity=activityRef.get();
  if (activity == null)   return new SignInResponse(false,false,null);
  Endpoint endpoint=MicroBlogAPIFactory.getOAuthSignInEndpoint(apiUrlFormat,sameOAuthSigningUrl);
  OAuthAuthorization auth=new OAuthAuthorization(consumerKey.getOauthToken(),consumerKey.getOauthTokenSecret());
  final TwitterOAuth oauth=MicroBlogAPIFactory.getInstance(activity,endpoint,auth,TwitterOAuth.class);
  final OAuthToken accessToken=oauth.getAccessToken(username,password);
  String userId=accessToken.getUserId();
  if (userId == null) {
    auth=new OAuthAuthorization(consumerKey.getOauthToken(),consumerKey.getOauthTokenSecret(),accessToken);
    endpoint=MicroBlogAPIFactory.getOAuthRestEndpoint(apiUrlFormat,sameOAuthSigningUrl,noVersionSuffix);
    MicroBlog microBlog=MicroBlogAPIFactory.getInstance(activity,endpoint,auth,MicroBlog.class);
    userId=microBlog.verifyCredentials().getId();
  }
  if (userId == null)   return new SignInResponse(false,false,null);
  return getOAuthSignInResponse(activity,accessToken,userId,AuthType.XAUTH);
}
