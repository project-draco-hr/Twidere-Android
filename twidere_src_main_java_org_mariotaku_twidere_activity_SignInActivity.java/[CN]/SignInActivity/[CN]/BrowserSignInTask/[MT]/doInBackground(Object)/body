{
  try {
    final String versionSuffix=noVersionSuffix ? null : "1.1";
    Endpoint endpoint=MicroBlogAPIFactory.getOAuthSignInEndpoint(apiUrlFormat,sameOauthSigningUrl);
    final TwitterOAuth oauth=MicroBlogAPIFactory.getInstance(context,endpoint,new OAuthAuthorization(consumerKey.getOauthToken(),consumerKey.getOauthTokenSecret()),TwitterOAuth.class);
    final OAuthToken accessToken;
    if (oauthVerifier != null) {
      accessToken=oauth.getAccessToken(requestToken,oauthVerifier);
    }
 else {
      accessToken=oauth.getAccessToken(requestToken);
    }
    final OAuthAuthorization auth=new OAuthAuthorization(consumerKey.getOauthToken(),consumerKey.getOauthTokenSecret(),accessToken);
    endpoint=MicroBlogAPIFactory.getOAuthEndpoint(apiUrlFormat,"api",versionSuffix,sameOauthSigningUrl);
    final MicroBlog twitter=MicroBlogAPIFactory.getInstance(context,endpoint,auth,MicroBlog.class);
    final User user=twitter.verifyCredentials();
    int color=analyseUserProfileColor(user);
    final Pair<String,String> accountType=detectAccountType(twitter,user);
    final ParcelableAccount account=ParcelableAccountUtils.getAccount(context,new UserKey(user.getId(),UserKeyUtils.getUserHost(user)));
    if (account != null) {
      color=account.color;
    }
    return new SignInResponse(account != null,auth,user,AuthType.OAUTH,color,apiUrlFormat,sameOauthSigningUrl,noVersionSuffix,accountType);
  }
 catch (  final MicroBlogException e) {
    return new SignInResponse(false,false,e);
  }
}
