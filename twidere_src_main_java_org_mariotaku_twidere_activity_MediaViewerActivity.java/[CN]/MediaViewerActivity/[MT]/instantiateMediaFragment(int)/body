{
  final ParcelableMedia media=getMedia()[position];
  final Bundle args=new Bundle();
  final Intent intent=getIntent();
  args.putParcelable(EXTRA_ACCOUNT_KEY,intent.getParcelableExtra(EXTRA_ACCOUNT_KEY));
  args.putParcelable(EXTRA_MEDIA,media);
  args.putParcelable(EXTRA_STATUS,intent.getParcelableExtra(EXTRA_STATUS));
switch (media.type) {
case ParcelableMedia.Type.IMAGE:
{
      if (media.media_url == null) {
        return (MediaViewerFragment)Fragment.instantiate(this,ExternalBrowserPageFragment.class.getName(),args);
      }
      args.putParcelable(ImagePageFragment.EXTRA_MEDIA_URI,Uri.parse(media.media_url));
      if (media.media_url.endsWith(".gif")) {
        return (MediaViewerFragment)Fragment.instantiate(this,GifPageFragment.class.getName(),args);
      }
 else {
        return (MediaViewerFragment)Fragment.instantiate(this,ImagePageFragment.class.getName(),args);
      }
    }
case ParcelableMedia.Type.ANIMATED_GIF:
case ParcelableMedia.Type.CARD_ANIMATED_GIF:
{
    args.putBoolean(VideoPageFragment.EXTRA_LOOP,true);
    return (MediaViewerFragment)Fragment.instantiate(this,VideoPageFragment.class.getName(),args);
  }
case ParcelableMedia.Type.VIDEO:
{
  return (MediaViewerFragment)Fragment.instantiate(this,VideoPageFragment.class.getName(),args);
}
case ParcelableMedia.Type.EXTERNAL_PLAYER:
{
return (MediaViewerFragment)Fragment.instantiate(this,ExternalBrowserPageFragment.class.getName(),args);
}
}
throw new UnsupportedOperationException(String.valueOf(media));
}
