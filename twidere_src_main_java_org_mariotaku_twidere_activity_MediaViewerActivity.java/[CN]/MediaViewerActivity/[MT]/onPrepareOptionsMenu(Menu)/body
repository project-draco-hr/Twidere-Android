{
  final ViewPager viewPager=findViewPager();
  final PagerAdapter adapter=viewPager.getAdapter();
  final int currentItem=viewPager.getCurrentItem();
  if (currentItem < 0 || currentItem >= adapter.getCount())   return false;
  final Object object=adapter.instantiateItem(viewPager,currentItem);
  if (!(object instanceof MediaViewerFragment))   return false;
  if (object instanceof CacheDownloadMediaViewerFragment) {
    CacheDownloadMediaViewerFragment f=(CacheDownloadMediaViewerFragment)object;
    final boolean running=f.getLoaderManager().hasRunningLoaders();
    final boolean downloaded=f.hasDownloadedData();
    MenuUtils.setMenuItemAvailability(menu,R.id.refresh,!running && !downloaded);
    MenuUtils.setMenuItemAvailability(menu,R.id.share,!running && downloaded);
    MenuUtils.setMenuItemAvailability(menu,R.id.save,!running && downloaded);
  }
 else {
    MenuUtils.setMenuItemAvailability(menu,R.id.refresh,false);
    MenuUtils.setMenuItemAvailability(menu,R.id.share,true);
    MenuUtils.setMenuItemAvailability(menu,R.id.save,false);
  }
  return true;
}
