{
  final ContentResolver cr=context.getContentResolver();
  final long startTime=TimeUnit.HOURS.convert(start.getTime(),TimeUnit.MILLISECONDS);
  final long endTime=TimeUnit.HOURS.convert(end.getTime(),TimeUnit.MILLISECONDS);
  final Expression where=Expression.and(Expression.greaterEquals(TwidereDataStore.NetworkUsages.TIME_IN_HOURS,startTime),Expression.lesserThan(TwidereDataStore.NetworkUsages.TIME_IN_HOURS,endTime));
  final int days=(int)TimeUnit.DAYS.convert(endTime - startTime,TimeUnit.HOURS);
  final Cursor c=cr.query(TwidereDataStore.NetworkUsages.CONTENT_URI,TwidereDataStore.NetworkUsages.COLUMNS,where.getSQL(),null,TwidereDataStore.NetworkUsages.TIME_IN_HOURS);
  final int idxDate=c.getColumnIndex(TwidereDataStore.NetworkUsages.TIME_IN_HOURS);
  final int idxSent=c.getColumnIndex(TwidereDataStore.NetworkUsages.KILOBYTES_SENT);
  final int idxReceived=c.getColumnIndex(TwidereDataStore.NetworkUsages.KILOBYTES_RECEIVED);
  final int idxType=c.getColumnIndex(TwidereDataStore.NetworkUsages.REQUEST_TYPE);
  final double[][] usageArray=new double[days][RequestType.values().length];
  double totalReceived=0, totalSent=0;
  c.moveToFirst();
  while (!c.isAfterLast()) {
    final long hours=c.getLong(idxDate);
    final int idx=(int)TimeUnit.DAYS.convert((hours - startTime),TimeUnit.HOURS);
    final double sent=c.getDouble(idxSent);
    final double received=c.getDouble(idxReceived);
    final String type=c.getString(idxType);
    usageArray[idx][RequestType.getValue(type)]+=(sent + received);
    totalReceived+=received;
    totalSent+=sent;
    c.moveToNext();
  }
  c.close();
  final BarSet apiSet=new BarSet();
  final BarSet mediaSet=new BarSet();
  final BarSet usageStatisticsSet=new BarSet();
  double dayMax=0;
  for (int i=0; i < days; i++) {
    String day=String.valueOf(i + 1);
    final double[] dayUsage=usageArray[i];
    apiSet.addBar(day,(float)dayUsage[RequestType.API.getValue()]);
    mediaSet.addBar(day,(float)dayUsage[RequestType.MEDIA.getValue()]);
    usageStatisticsSet.addBar(day,(float)dayUsage[RequestType.USAGE_STATISTICS.getValue()]);
    dayMax=Math.max(dayMax,MathUtils.sum(dayUsage));
  }
  apiSet.setColor(Color.RED);
  mediaSet.setColor(Color.GREEN);
  usageStatisticsSet.setColor(Color.BLUE);
  final ArrayList<ChartSet> data=new ArrayList<>();
  data.add(apiSet);
  data.add(mediaSet);
  data.add(usageStatisticsSet);
  return new NetworkUsageInfo(data,totalReceived,totalSent,dayMax);
}
