{
  intent.setExtrasClassLoader(context.getClassLoader());
  final Bundle extras=intent.getExtras();
  final Uri uri=intent.getData();
  final Fragment fragment;
  if (uri == null)   return null;
  final Bundle args=new Bundle();
  if (extras != null) {
    args.putAll(extras);
  }
  boolean isAccountIdRequired=true;
switch (linkId) {
case LINK_ID_ACCOUNTS:
{
      fragment=new AccountsManagerFragment();
      break;
    }
case LINK_ID_DRAFTS:
{
    fragment=new DraftsFragment();
    break;
  }
case LINK_ID_FILTERS:
{
  fragment=new FiltersFragment();
  break;
}
case LINK_ID_PROFILE_EDITOR:
{
fragment=new UserProfileEditorFragment();
break;
}
case LINK_ID_MAP:
{
if (!args.containsKey(EXTRA_LATITUDE) && !args.containsKey(EXTRA_LONGITUDE)) {
final double lat=NumberUtils.toDouble(uri.getQueryParameter(QUERY_PARAM_LAT),Double.NaN);
final double lng=NumberUtils.toDouble(uri.getQueryParameter(QUERY_PARAM_LNG),Double.NaN);
if (Double.isNaN(lat) || Double.isNaN(lng)) return null;
args.putDouble(EXTRA_LATITUDE,lat);
args.putDouble(EXTRA_LONGITUDE,lng);
}
fragment=MapFragmentFactory.SINGLETON.createMapFragment(context);
break;
}
case LINK_ID_STATUS:
{
fragment=new StatusFragment();
if (!args.containsKey(EXTRA_STATUS_ID)) {
final String paramStatusId=uri.getQueryParameter(QUERY_PARAM_STATUS_ID);
args.putString(EXTRA_STATUS_ID,paramStatusId);
}
break;
}
case LINK_ID_USER:
{
fragment=new UserFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
args.putString(EXTRA_REFERRAL,intent.getStringExtra(EXTRA_REFERRAL));
break;
}
case LINK_ID_USER_LIST_MEMBERSHIPS:
{
fragment=new UserListMembershipsFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
break;
}
case LINK_ID_USER_TIMELINE:
{
fragment=new UserTimelineFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
if (isEmpty(paramScreenName) && isEmpty(paramUserId)) return null;
break;
}
case LINK_ID_USER_MEDIA_TIMELINE:
{
fragment=new UserMediaTimelineFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
if (isEmpty(paramScreenName) && isEmpty(paramUserId)) return null;
break;
}
case LINK_ID_USER_FAVORITES:
{
fragment=new UserFavoritesFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
if (!args.containsKey(EXTRA_SCREEN_NAME) && !args.containsKey(EXTRA_USER_ID)) return null;
break;
}
case LINK_ID_USER_FOLLOWERS:
{
fragment=new UserFollowersFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
if (isEmpty(paramScreenName) && isEmpty(paramUserId)) return null;
break;
}
case LINK_ID_USER_FRIENDS:
{
fragment=new UserFriendsFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
if (isEmpty(paramScreenName) && isEmpty(paramUserId)) return null;
break;
}
case LINK_ID_USER_BLOCKS:
{
fragment=new UserBlocksListFragment();
break;
}
case LINK_ID_MUTES_USERS:
{
fragment=new MutesUsersListFragment();
break;
}
case LINK_ID_SCHEDULED_STATUSES:
{
fragment=new ScheduledStatusesFragment();
break;
}
case LINK_ID_DIRECT_MESSAGES_CONVERSATION:
{
fragment=new MessagesConversationFragment();
isAccountIdRequired=false;
final String paramRecipientId=uri.getQueryParameter(QUERY_PARAM_RECIPIENT_ID);
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
if (paramRecipientId != null) {
args.putString(EXTRA_RECIPIENT_ID,paramRecipientId);
}
 else if (paramScreenName != null) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
break;
}
case LINK_ID_DIRECT_MESSAGES:
{
fragment=new DirectMessagesFragment();
break;
}
case LINK_ID_INTERACTIONS:
{
fragment=new InteractionsTimelineFragment();
break;
}
case LINK_ID_PUBLIC_TIMELINE:
{
fragment=new PublicTimelineFragment();
break;
}
case LINK_ID_USER_LIST:
{
fragment=new UserListFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
final String paramListId=uri.getQueryParameter(QUERY_PARAM_LIST_ID);
final String paramListName=uri.getQueryParameter(QUERY_PARAM_LIST_NAME);
if (isEmpty(paramListId) && (isEmpty(paramListName) || isEmpty(paramScreenName) && isEmpty(paramUserId))) return null;
args.putLong(EXTRA_LIST_ID,NumberUtils.toLong(paramListId,-1));
args.putString(EXTRA_USER_ID,paramUserId);
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
args.putString(EXTRA_LIST_NAME,paramListName);
break;
}
case LINK_ID_USER_LISTS:
{
fragment=new ListsFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
if (isEmpty(paramScreenName) && isEmpty(paramUserId)) return null;
break;
}
case LINK_ID_USER_GROUPS:
{
fragment=new UserGroupsFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
if (!args.containsKey(EXTRA_SCREEN_NAME)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (!args.containsKey(EXTRA_USER_ID)) {
args.putString(EXTRA_USER_ID,paramUserId);
}
if (isEmpty(paramScreenName) && isEmpty(paramUserId)) return null;
break;
}
case LINK_ID_USER_LIST_TIMELINE:
{
fragment=new UserListTimelineFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
final String paramListId=uri.getQueryParameter(QUERY_PARAM_LIST_ID);
final String paramListName=uri.getQueryParameter(QUERY_PARAM_LIST_NAME);
if (isEmpty(paramListId) && (isEmpty(paramListName) || isEmpty(paramScreenName) && isEmpty(paramUserId))) return null;
args.putLong(EXTRA_LIST_ID,NumberUtils.toLong(paramListId,-1));
args.putString(EXTRA_USER_ID,paramUserId);
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
args.putString(EXTRA_LIST_NAME,paramListName);
break;
}
case LINK_ID_USER_LIST_MEMBERS:
{
fragment=new UserListMembersFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
final String paramListId=uri.getQueryParameter(QUERY_PARAM_LIST_ID);
final String paramListName=uri.getQueryParameter(QUERY_PARAM_LIST_NAME);
if (isEmpty(paramListId) && (isEmpty(paramListName) || isEmpty(paramScreenName) && isEmpty(paramUserId))) return null;
args.putLong(EXTRA_LIST_ID,NumberUtils.toLong(paramListId,-1));
args.putString(EXTRA_USER_ID,paramUserId);
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
args.putString(EXTRA_LIST_NAME,paramListName);
break;
}
case LINK_ID_USER_LIST_SUBSCRIBERS:
{
fragment=new UserListSubscribersFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
final String paramUserId=uri.getQueryParameter(QUERY_PARAM_USER_ID);
final String paramListId=uri.getQueryParameter(QUERY_PARAM_LIST_ID);
final String paramListName=uri.getQueryParameter(QUERY_PARAM_LIST_NAME);
if (isEmpty(paramListId) && (isEmpty(paramListName) || isEmpty(paramScreenName) && isEmpty(paramUserId))) return null;
args.putLong(EXTRA_LIST_ID,NumberUtils.toLong(paramListId,-1));
args.putString(EXTRA_USER_ID,paramUserId);
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
args.putString(EXTRA_LIST_NAME,paramListName);
break;
}
case LINK_ID_SAVED_SEARCHES:
{
fragment=new SavedSearchesListFragment();
break;
}
case LINK_ID_USER_MENTIONS:
{
fragment=new UserMentionsFragment();
final String paramScreenName=uri.getQueryParameter(QUERY_PARAM_SCREEN_NAME);
if (!args.containsKey(EXTRA_SCREEN_NAME) && !isEmpty(paramScreenName)) {
args.putString(EXTRA_SCREEN_NAME,paramScreenName);
}
if (isEmpty(args.getString(EXTRA_SCREEN_NAME))) return null;
break;
}
case LINK_ID_INCOMING_FRIENDSHIPS:
{
fragment=new IncomingFriendshipsFragment();
break;
}
case LINK_ID_ITEMS:
{
fragment=new ItemsListFragment();
break;
}
case LINK_ID_STATUS_RETWEETERS:
{
fragment=new StatusRetweetersListFragment();
if (!args.containsKey(EXTRA_STATUS_ID)) {
final String paramStatusId=uri.getQueryParameter(QUERY_PARAM_STATUS_ID);
args.putString(EXTRA_STATUS_ID,paramStatusId);
}
break;
}
case LINK_ID_STATUS_FAVORITERS:
{
fragment=new StatusFavoritersListFragment();
if (!args.containsKey(EXTRA_STATUS_ID)) {
final String paramStatusId=uri.getQueryParameter(QUERY_PARAM_STATUS_ID);
args.putString(EXTRA_STATUS_ID,paramStatusId);
}
break;
}
case LINK_ID_SEARCH:
{
final String paramQuery=uri.getQueryParameter(QUERY_PARAM_QUERY);
if (!args.containsKey(EXTRA_QUERY) && !isEmpty(paramQuery)) {
args.putString(EXTRA_QUERY,paramQuery);
}
if (!args.containsKey(EXTRA_QUERY)) {
return null;
}
fragment=new SearchFragment();
break;
}
default :
{
return null;
}
}
UserKey accountKey=UserKey.valueOf(uri.getQueryParameter(QUERY_PARAM_ACCOUNT_KEY));
if (accountKey == null) {
final String accountId=uri.getQueryParameter(QUERY_PARAM_ACCOUNT_ID);
final String paramAccountName=uri.getQueryParameter(QUERY_PARAM_ACCOUNT_NAME);
if (accountId != null) {
accountKey=DataStoreUtils.findAccountKey(context,accountId);
args.putParcelable(EXTRA_ACCOUNT_KEY,accountKey);
}
 else if (paramAccountName != null) {
accountKey=DataStoreUtils.findAccountKeyByScreenName(context,paramAccountName);
}
 else {
accountKey=getDefaultAccountKey(context);
}
}
if (isAccountIdRequired && accountKey == null) {
return null;
}
args.putParcelable(EXTRA_ACCOUNT_KEY,accountKey);
fragment.setArguments(args);
return fragment;
}
