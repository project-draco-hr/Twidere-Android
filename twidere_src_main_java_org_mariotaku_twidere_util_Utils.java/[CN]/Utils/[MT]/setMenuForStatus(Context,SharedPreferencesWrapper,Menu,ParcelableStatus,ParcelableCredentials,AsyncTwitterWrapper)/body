{
  if (context == null || menu == null || status == null || account == null)   return;
  final Resources resources=context.getResources();
  final int retweetHighlight=ContextCompat.getColor(context,R.color.highlight_retweet);
  final int favoriteHighlight=ContextCompat.getColor(context,R.color.highlight_favorite);
  final int likeHighlight=ContextCompat.getColor(context,R.color.highlight_like);
  final boolean isMyRetweet;
  if (twitter.isCreatingRetweet(status.account_id,status.id)) {
    isMyRetweet=true;
  }
 else   if (twitter.isDestroyingStatus(status.account_id,status.id)) {
    isMyRetweet=false;
  }
 else {
    isMyRetweet=status.retweeted || isMyRetweet(status);
  }
  final MenuItem delete=menu.findItem(R.id.delete);
  if (delete != null) {
    delete.setVisible(isMyStatus(status));
  }
  final MenuItem retweet=menu.findItem(R.id.retweet);
  if (retweet != null) {
    ActionIconDrawable.setMenuHighlight(retweet,new TwidereMenuInfo(isMyRetweet,retweetHighlight));
    retweet.setTitle(isMyRetweet ? R.string.cancel_retweet : R.string.retweet);
  }
  final MenuItem favorite=menu.findItem(R.id.favorite);
  if (favorite != null) {
    final boolean isFavorite;
    if (twitter.isCreatingFavorite(status.account_id,status.id)) {
      isFavorite=true;
    }
 else     if (twitter.isDestroyingFavorite(status.account_id,status.id)) {
      isFavorite=false;
    }
 else {
      isFavorite=status.is_favorite;
    }
    ActionProvider provider=MenuItemCompat.getActionProvider(favorite);
    final boolean useStar=preferences.getBoolean(KEY_I_WANT_MY_STARS_BACK);
    if (provider instanceof FavoriteItemProvider) {
      ((FavoriteItemProvider)provider).setIsFavorite(favorite,isFavorite);
    }
 else {
      if (useStar) {
        final Drawable oldIcon=favorite.getIcon();
        if (oldIcon instanceof ActionIconDrawable) {
          final Drawable starIcon=ContextCompat.getDrawable(context,R.drawable.ic_action_star);
          favorite.setIcon(new ActionIconDrawable(starIcon,((ActionIconDrawable)oldIcon).getDefaultColor()));
        }
 else {
          favorite.setIcon(R.drawable.ic_action_star);
        }
        ActionIconDrawable.setMenuHighlight(favorite,new TwidereMenuInfo(isFavorite,favoriteHighlight));
      }
 else {
        ActionIconDrawable.setMenuHighlight(favorite,new TwidereMenuInfo(isFavorite,likeHighlight));
      }
    }
    if (useStar) {
      favorite.setTitle(isFavorite ? R.string.unfavorite : R.string.favorite);
    }
 else {
      favorite.setTitle(isFavorite ? R.string.undo_like : R.string.like);
    }
  }
  final MenuItem translate=menu.findItem(R.id.translate);
  if (translate != null) {
    final boolean isOfficialKey=isOfficialCredentials(context,account);
    final SharedPreferencesWrapper prefs=SharedPreferencesWrapper.getInstance(context,SHARED_PREFERENCES_NAME,Context.MODE_PRIVATE);
    final boolean forcePrivateApis=prefs.getBoolean(KEY_FORCE_USING_PRIVATE_APIS,false);
    MenuUtils.setMenuItemAvailability(menu,R.id.translate,forcePrivateApis || isOfficialKey);
  }
  menu.removeGroup(MENU_GROUP_STATUS_EXTENSION);
  addIntentToMenuForExtension(context,menu,MENU_GROUP_STATUS_EXTENSION,INTENT_ACTION_EXTENSION_OPEN_STATUS,EXTRA_STATUS,EXTRA_STATUS_JSON,status);
  final MenuItem shareItem=menu.findItem(R.id.share);
  final ActionProvider shareProvider=MenuItemCompat.getActionProvider(shareItem);
  if (shareProvider instanceof SupportStatusShareProvider) {
    ((SupportStatusShareProvider)shareProvider).setStatus(status);
  }
 else   if (shareProvider instanceof ShareActionProvider) {
    final Intent shareIntent=createStatusShareIntent(context,status);
    ((ShareActionProvider)shareProvider).setShareIntent(shareIntent);
  }
 else   if (shareItem.hasSubMenu()) {
    final Menu shareSubMenu=shareItem.getSubMenu();
    final Intent shareIntent=createStatusShareIntent(context,status);
    shareSubMenu.removeGroup(MENU_GROUP_STATUS_SHARE);
    MenuUtils.addIntentToMenu(context,shareSubMenu,shareIntent,MENU_GROUP_STATUS_SHARE);
  }
 else {
    final Intent shareIntent=createStatusShareIntent(context,status);
    final Intent chooserIntent=Intent.createChooser(shareIntent,context.getString(R.string.share_status));
    addCopyLinkIntent(context,chooserIntent,LinkCreator.getTwitterStatusLink(status));
    shareItem.setIntent(chooserIntent);
  }
}
