{
  if (context == null || menu == null || status == null || account == null)   return;
  final Resources resources=context.getResources();
  final int retweetHighlight=resources.getColor(R.color.highlight_retweet);
  final int favoriteHighlight=resources.getColor(R.color.highlight_favorite);
  final boolean isMyRetweet=isMyRetweet(status);
  final MenuItem delete=menu.findItem(MENU_DELETE);
  if (delete != null) {
    delete.setVisible(status.account_id == status.user_id && !isMyRetweet);
  }
  final MenuItem retweet=menu.findItem(MENU_RETWEET);
  if (retweet != null) {
    retweet.setVisible(!status.user_is_protected || isMyRetweet);
    ActionIconDrawable.setMenuHighlight(retweet,new TwidereMenuInfo(isMyRetweet,retweetHighlight));
    retweet.setTitle(isMyRetweet ? R.string.cancel_retweet : R.string.retweet);
  }
  final MenuItem retweetSubItem=menu.findItem(R.id.retweet_submenu);
  if (retweetSubItem != null) {
    ActionIconDrawable.setMenuHighlight(retweetSubItem,new TwidereMenuInfo(isMyRetweet,retweetHighlight));
  }
  final MenuItem favorite=menu.findItem(MENU_FAVORITE);
  if (favorite != null) {
    ActionIconDrawable.setMenuHighlight(favorite,new TwidereMenuInfo(status.is_favorite,favoriteHighlight));
    favorite.setTitle(status.is_favorite ? R.string.unfavorite : R.string.favorite);
  }
  final MenuItem translate=menu.findItem(MENU_TRANSLATE);
  if (translate != null) {
    final boolean isOfficialKey=isOfficialCredentials(context,account);
    final SharedPreferencesWrapper prefs=SharedPreferencesWrapper.getInstance(context,SHARED_PREFERENCES_NAME,Context.MODE_PRIVATE);
    final boolean forcePrivateApis=prefs.getBoolean(KEY_FORCE_USING_PRIVATE_APIS,false);
    setMenuItemAvailability(menu,MENU_TRANSLATE,forcePrivateApis || isOfficialKey);
  }
  menu.removeGroup(MENU_GROUP_STATUS_EXTENSION);
  addIntentToMenuForExtension(context,menu,MENU_GROUP_STATUS_EXTENSION,INTENT_ACTION_EXTENSION_OPEN_STATUS,EXTRA_STATUS,EXTRA_STATUS_JSON,status);
  final MenuItem shareItem=menu.findItem(R.id.share);
  final ActionProvider shareProvider=MenuItemCompat.getActionProvider(shareItem);
  if (shareProvider instanceof SupportStatusShareProvider) {
    ((SupportStatusShareProvider)shareProvider).setStatus(status);
  }
 else   if (shareProvider instanceof ShareActionProvider) {
    final Intent shareIntent=createStatusShareIntent(context,status);
    ((ShareActionProvider)shareProvider).setShareIntent(shareIntent);
  }
 else   if (shareItem.hasSubMenu()) {
    final Menu shareSubMenu=shareItem.getSubMenu();
    final Intent shareIntent=createStatusShareIntent(context,status);
    shareSubMenu.removeGroup(MENU_GROUP_STATUS_SHARE);
    addIntentToMenu(context,shareSubMenu,shareIntent,MENU_GROUP_STATUS_SHARE);
  }
}
