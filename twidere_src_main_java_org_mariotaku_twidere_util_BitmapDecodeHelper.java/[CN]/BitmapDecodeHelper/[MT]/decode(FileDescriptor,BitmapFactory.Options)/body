{
  if (fd == null)   return null;
  final int orientation=Exif.getOrientation(new FileInputStream(fd));
  final Bitmap bm=BitmapFactory.decodeFileDescriptor(fd,null,opts);
  final Matrix m=new Matrix();
switch (orientation) {
case 270:
case 90:
    m.postRotate(orientation);
  return Bitmap.createBitmap(bm,0,0,bm.getWidth(),bm.getHeight(),m,true);
case 180:
m.postRotate(orientation);
m.postScale(bm.getWidth(),bm.getHeight());
return Bitmap.createBitmap(bm,0,0,bm.getWidth(),bm.getHeight(),m,true);
}
return bm;
}
